<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>РетроКонсоль 999 - Полная Коллекция</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        
        .console-container {
            background: #2a2a3a;
            border: 12px solid #1a1a2a;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 
                0 0 60px rgba(0,255,100,0.4),
                inset 0 0 30px rgba(0,0,0,0.6);
            position: relative;
            max-width: 95vw;
            max-height: 95vh;
        }
        
        .console-header {
            text-align: center;
            margin-bottom: 30px;
            color: #00ff64;
            font-size: 20px;
            text-shadow: 0 0 20px #00ff64;
            letter-spacing: 3px;
            animation: headerGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes headerGlow {
            from { text-shadow: 0 0 20px #00ff64; }
            to { text-shadow: 0 0 40px #00ff64, 0 0 60px #00ff64; }
        }
        
        .main-layout {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }
        
        .game-selector {
            background: #1a1a2a;
            border: 4px solid #00ff64;
            border-radius: 15px;
            padding: 20px;
            min-width: 220px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .selector-title {
            color: #00ff64;
            font-size: 10px;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #00ff64;
        }
        
        .game-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .game-item {
            background: linear-gradient(45deg, #2a4a2a, #1a3a1a);
            border: 2px solid #00ff64;
            color: #00ff64;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 8px;
            text-align: center;
            position: relative;
        }
        
        .game-item:hover {
            background: linear-gradient(45deg, #3a5a3a, #2a4a2a);
            box-shadow: 0 0 15px rgba(0,255,100,0.6);
            transform: translateY(-2px);
        }
        
        .game-item.active {
            background: linear-gradient(45deg, #4a6a4a, #3a5a3a);
            box-shadow: 0 0 20px rgba(0,255,100,0.8);
        }
        
        .game-icon {
            font-size: 20px;
            margin-bottom: 6px;
            display: block;
        }
        
        .game-title {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .game-genre {
            font-size: 6px;
            color: #888;
        }
        
        .game-screen {
            background: #000;
            border: 6px solid #00ff64;
            border-radius: 15px;
            position: relative;
            box-shadow: 
                0 0 40px rgba(0,255,100,0.6),
                inset 0 0 20px rgba(0,255,100,0.1);
        }
        
        .game-canvas {
            display: block;
            background: #000;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .controls-panel {
            background: #1a1a2a;
            border: 4px solid #ff6464;
            border-radius: 15px;
            padding: 20px;
            min-width: 220px;
        }
        
        .controls-title {
            color: #ff6464;
            font-size: 10px;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #ff6464;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #4a2a2a, #3a1a1a);
            border: 2px solid #ff6464;
            color: #ff6464;
            padding: 10px 6px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 7px;
            text-align: center;
            font-family: 'Press Start 2P';
        }
        
        .control-btn:hover {
            background: linear-gradient(45deg, #5a3a3a, #4a2a2a);
            box-shadow: 0 0 10px rgba(255,100,100,0.5);
        }
        
        .control-btn:active {
            transform: scale(0.95);
            background: linear-gradient(45deg, #6a4a4a, #5a3a3a);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .action-btn {
            background: linear-gradient(45deg, #2a2a4a, #1a1a3a);
            border: 2px solid #6464ff;
            color: #6464ff;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 8px;
            font-family: 'Press Start 2P';
        }
        
        .action-btn:hover {
            background: linear-gradient(45deg, #3a3a5a, #2a2a4a);
            box-shadow: 0 0 10px rgba(100,100,255,0.5);
        }
        
        .settings-btn {
            background: linear-gradient(45deg, #4a2a4a, #3a1a3a);
            border: 2px solid #ff64ff;
            color: #ff64ff;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 7px;
            font-family: 'Press Start 2P';
            width: 100%;
            margin-bottom: 15px;
        }
        
        .settings-btn:hover {
            background: linear-gradient(45deg, #5a3a5a, #4a2a4a);
            box-shadow: 0 0 10px rgba(255,100,255,0.5);
        }
        
        .settings-panel {
            background: #1a1a2a;
            border: 4px solid #ff64ff;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: none;
        }
        
        .settings-title {
            color: #ff64ff;
            font-size: 8px;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 0 0 8px #ff64ff;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 6px;
            color: #ccc;
        }
        
        .setting-select {
            background: #333;
            border: 1px solid #ff64ff;
            color: #ff64ff;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 6px;
            font-family: 'Press Start 2P';
        }
        
        .game-info {
            background: #1a1a2a;
            border: 4px solid #ffff64;
            border-radius: 10px;
            padding: 12px;
            color: #ffff64;
            font-size: 7px;
            line-height: 1.4;
        }
        
        .info-title {
            font-size: 8px;
            margin-bottom: 8px;
            text-align: center;
            text-shadow: 0 0 8px #ffff64;
        }
        
        .score-display {
            position: absolute;
            top: 8px;
            right: 8px;
            color: #ffff64;
            font-size: 10px;
            text-shadow: 0 0 8px #ffff64;
            z-index: 50;
            font-family: 'Press Start 2P';
        }
        
        .lives-display {
            position: absolute;
            top: 8px;
            left: 8px;
            color: #ff6464;
            font-size: 10px;
            text-shadow: 0 0 8px #ff6464;
            z-index: 50;
            font-family: 'Press Start 2P';
        }
        
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-family: 'Press Start 2P';
            z-index: 100;
        }
        
        .overlay-title {
            font-size: 24px;
            margin-bottom: 15px;
            text-shadow: 0 0 15px #fff;
            animation: overlayPulse 2s ease-in-out infinite;
        }
        
        @keyframes overlayPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000, #222);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #00ff64;
            font-family: 'Press Start 2P';
            z-index: 200;
        }
        
        .loading-title {
            font-size: 16px;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #00ff64;
        }
        
        .loading-bar {
            width: 300px;
            height: 20px;
            border: 2px solid #00ff64;
            border-radius: 4px;
            overflow: hidden;
            background: #000;
        }
        
        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff64, #64ff64);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px #00ff64;
        }
        
        .pixel-perfect {
            image-rendering: -moz-crisp-edges;
            image-rendering: -webkit-crisp-edges;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        
        @media (max-width: 1200px) {
            .main-layout {
                flex-direction: column;
                gap: 20px;
            }
            
            .console-container {
                padding: 20px;
            }
            
            .game-selector, .controls-panel {
                min-width: auto;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="console-container">
        <div class="console-header">
            🎮 РЕТРОКОНСОЛЬ 999 - ПОЛНАЯ КОЛЛЕКЦИЯ 🎮
        </div>
        
        <div class="main-layout">
            <div class="game-selector">
                <div class="selector-title">ВЫБОР ИГРЫ</div>
                <div class="game-list" id="gameList"></div>
            </div>
            
            <div class="game-screen">
                <canvas class="game-canvas pixel-perfect" id="gameCanvas" width="640" height="480"></canvas>
                
                <div class="score-display" id="scoreDisplay">СЧЁТ: 000000</div>
                <div class="lives-display" id="livesDisplay">ЖИЗНИ: 3</div>
                
                <div class="game-overlay" id="gameOverlay">
                    <div class="overlay-title" id="overlayTitle">ИГРА ОКОНЧЕНА</div>
                    <div id="overlayText">Нажмите СТАРТ чтобы играть снова</div>
                </div>
                
                <div class="loading-screen" id="loadingScreen">
                    <div class="loading-title">ЗАГРУЗКА ИГРЫ...</div>
                    <div class="loading-bar">
                        <div class="loading-fill" id="loadingFill"></div>
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="controls-title">УПРАВЛЕНИЕ</div>
                
                <button class="settings-btn" id="settingsBtn">НАСТРОЙКИ</button>
                
                <div class="settings-panel" id="settingsPanel">
                    <div class="settings-title">НАСТРОЙКИ</div>
                    <div class="setting-item">
                        <span>Звук:</span>
                        <select class="setting-select" id="soundSetting">
                            <option value="on">ВКЛ</option>
                            <option value="off">ВЫКЛ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Управление:</span>
                        <select class="setting-select" id="controlSetting">
                            <option value="arrows">СТРЕЛКИ</option>
                            <option value="wasd">WASD</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>Скорость:</span>
                        <select class="setting-select" id="speedSetting">
                            <option value="normal">НОРМАЛЬНАЯ</option>
                            <option value="fast">БЫСТРАЯ</option>
                            <option value="slow">МЕДЛЕННАЯ</option>
                        </select>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <div></div>
                    <button class="control-btn" data-key="ArrowUp">▲</button>
                    <div></div>
                    <button class="control-btn" data-key="ArrowLeft">◄</button>
                    <button class="control-btn" data-key="Space">●</button>
                    <button class="control-btn" data-key="ArrowRight">►</button>
                    <div></div>
                    <button class="control-btn" data-key="ArrowDown">▼</button>
                    <div></div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" id="startBtn">СТАРТ</button>
                    <button class="action-btn" id="pauseBtn">ПАУЗА</button>
                    <button class="action-btn" id="resetBtn">СБРОС</button>
                </div>
                
                <div class="game-info" id="gameInfo">
                    <div class="info-title">ИНФО ОБ ИГРЕ</div>
                    <div id="gameDescription">
                        Выберите игру из списка для просмотра информации и начала игры. Все игры полностью функциональны!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        ctx.imageSmoothingEnabled = false;
        ctx.webkitImageSmoothingEnabled = false;
        ctx.mozImageSmoothingEnabled = false;
        ctx.msImageSmoothingEnabled = false;
        
        let gameSettings = {
            sound: true,
            controls: 'arrows',
            speed: 'normal'
        };
        
        class ChiptuneSystem {
            constructor() {
                this.audioContext = null;
                this.masterVolume = 0.2;
                this.initAudio();
            }
            
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
            
            createTone(frequency, duration, type = 'square', volume = 1) {
                if (!this.audioContext || !gameSettings.sound) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(this.masterVolume * volume, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playMove() { this.createTone(220, 0.1, 'square'); }
            playJump() { this.createTone(440, 0.2, 'square'); }
            playShoot() { this.createTone(660, 0.15, 'square'); }
            playExplosion() { this.createTone(110, 0.4, 'sawtooth'); }
            playPickup() { this.createTone(880, 0.2, 'triangle'); }
            playLineClear() { 
                const notes = [523, 659, 784, 1047];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.2), i * 100);
                });
            }
            playGameOver() {
                const notes = [440, 415, 392, 370, 349, 330, 311, 294];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.3), i * 150);
                });
            }
        }
        
        const soundSystem = new ChiptuneSystem();
        
        const games = [
            { id: 'tetris', title: 'ТЕТРИС', icon: '🧩', genre: 'ГОЛОВОЛОМКА', description: 'Классическая головоломка с падающими блоками! Складывайте тетромино для очистки линий.' },
            { id: 'pong', title: 'ПОНГ', icon: '🏓', genre: 'СПОРТ', description: 'Первая видеоигра! Классический теннис с двумя платформами.' },
            { id: 'invaders', title: 'ЗАХВАТЧИКИ', icon: '👾', genre: 'ШУТЕР', description: 'Легендарный Space Invaders! Уничтожайте ряды спускающихся пришельцев.' },
            { id: 'snake', title: 'ЗМЕЙКА', icon: '🐍', genre: 'АРКАДА', description: 'Классическая змейка! Ешьте еду и растите, избегая столкновений.' },
            { id: 'breakout', title: 'АРКАНОИД', icon: '🧱', genre: 'АРКАДА', description: 'Разбивайте блоки мячом! Не дайте мячу упасть.' },
            { id: 'pacman', title: 'ПАКМАН', icon: '🟡', genre: 'ЛАБИРИНТ', description: 'Съедайте точки в лабиринте, избегая призраков!' },
            { id: 'asteroids', title: 'АСТЕРОИДЫ', icon: '🌌', genre: 'ШУТЕР', description: 'Космический шутер! Уничтожайте астероиды в открытом космосе.' },
            { id: 'frogger', title: 'ЛЯГУШКА', icon: '🐸', genre: 'АРКАДА', description: 'Переходите дорогу и реку, избегая опасностей!' },
            { id: 'missile', title: 'РАКЕТНАЯ КОМАНДА', icon: '🚀', genre: 'ЗАЩИТА', description: 'Защищайте города от ракетного удара!' },
            { id: 'centipede', title: 'СОРОКОНОЖКА', icon: '🐛', genre: 'ШУТЕР', description: 'Стреляйте по сороконожке через поле грибов!' },
            { id: 'donkey', title: 'ГОРИЛЛА КИНГ', icon: '🦍', genre: 'ПЛАТФОРМЕР', description: 'Поднимайтесь по конструкции, избегая бочек!' },
            { id: 'defender', title: 'ЗАЩИТНИК', icon: '🛡️', genre: 'ШУТЕР', description: 'Защищайте планету от захватчиков!' },
            { id: 'burger', title: 'ВРЕМЯ БУРГЕРОВ', icon: '🍔', genre: 'ПЛАТФОРМЕР', description: 'Готовьте бургеры, сбивая ингредиенты!' },
            { id: 'digdug', title: 'КОПАТЕЛЬ', icon: '⛏️', genre: 'ЭКШЕН', description: 'Копайте туннели и побеждайте врагов!' },
            { id: 'popeye', title: 'МОРЯК ПОПАЙ', icon: '🚢', genre: 'ПЛАТФОРМЕР', description: 'Собирайте сердечки для Олив!' },
            { id: 'loderunner', title: 'ЗОЛОТОИСКАТЕЛЬ', icon: '💎', genre: 'ГОЛОВОЛОМКА', description: 'Собирайте золото, избегая охранников!' },
            { id: 'paperboy', title: 'РАЗНОСЧИК ГАЗЕТ', icon: '📰', genre: 'ЭКШЕН', description: 'Доставляйте газеты на велосипеде!' },
            { id: 'joust', title: 'РЫЦАРСКИЙ ТУРНИР', icon: '🏇', genre: 'ЭКШЕН', description: 'Сражайтесь на летающих страусах!' },
            { id: 'tempest', title: 'БУРЯ', icon: '🌀', genre: 'ШУТЕР', description: 'Стреляйте по врагам в туннеле!' },
            { id: 'spy', title: 'СУПЕР ШПИОН', icon: '🕵️', genre: 'ЭКШЕН', description: 'Проникните в секретную базу!' },
            { id: 'miner', title: 'ШАХТЕР', icon: '⛏️', genre: 'СТРАТЕГИЯ', description: 'Копайте шахты и собирайте драгоценности!' },
            { id: 'wizard', title: 'ВОЛШЕБНИК', icon: '🧙', genre: 'ПРИКЛЮЧЕНИЕ', description: 'Используйте магию для решения головоломок!' },
            { id: 'robot', title: 'РОБОТ-СПАСАТЕЛЬ', icon: '🤖', genre: 'ЭКШЕН', description: 'Спасайте людей из горящих зданий!' },
            { id: 'atlantis', title: 'АТЛАНТИДА', icon: '🏛️', genre: 'ЗАЩИТА', description: 'Защищайте Атлантиду от атак!' },
            { id: 'moonlander', title: 'ЛУННЫЙ ПОСАДОЧНЫЙ', icon: '🚀', genre: 'СИМУЛЯТОР', description: 'Приземлитесь на Луну!' },
            { id: 'knight', title: 'РЫЦАРЬ', icon: '⚔️', genre: 'ПРИКЛЮЧЕНИЕ', description: 'Средневековые приключения рыцаря!' },
            { id: 'submarine', title: 'ПОДВОДНАЯ ЛОДКА', icon: '🚤', genre: 'ЭКШЕН', description: 'Подводные сражения!' },
            { id: 'pinball', title: 'ПИНБОЛ', icon: '🔮', genre: 'АРКАДА', description: 'Классический пинбол!' },
            { id: 'maze', title: 'ЛАБИРИНТ 3D', icon: '🗝️', genre: 'ГОЛОВОЛОМКА', description: 'Найдите выход из лабиринта!' },
            { id: 'racing', title: 'СУПЕР ГОНЩИК', icon: '🏎️', genre: 'ГОНКИ', description: 'Высокоскоростные гонки!' }
        ];
        
        let currentGame = null;
        let activeGameInstance = null;
        let gameRunning = false;
        let keys = {};
        
        function getKey(action) {
            if (gameSettings.controls === 'wasd') {
                const wasdMap = {
                    'ArrowUp': 'KeyW',
                    'ArrowDown': 'KeyS',
                    'ArrowLeft': 'KeyA',
                    'ArrowRight': 'KeyD'
                };
                return wasdMap[action] || action;
            }
            return action;
        }
        
        class BaseGame {
            constructor() {
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                this.running = false;
                this.paused = false;
                this.speedMultiplier = 1;
            }
            
            init() {
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                this.speedMultiplier = gameSettings.speed === 'fast' ? 1.5 : gameSettings.speed === 'slow' ? 0.7 : 1;
                this.updateUI();
                this.setupGame();
            }
            
            setupGame() {}
            
            start() {
                this.running = true;
                this.paused = false;
                this.gameLoop();
            }
            
            stop() {
                this.running = false;
            }
            
            pause() {
                this.paused = !this.paused;
            }
            
            gameLoop() {
                if (!this.running) return;
                
                if (!this.paused) {
                    this.update();
                    this.draw();
                }
                
                requestAnimationFrame(() => this.gameLoop());
            }
            
            update() {}
            draw() {}
            
            updateUI() {
                document.getElementById('scoreDisplay').textContent = `СЧЁТ: ${this.score.toString().padStart(6, '0')}`;
                document.getElementById('livesDisplay').textContent = `ЖИЗНИ: ${this.lives}`;
            }
            
            gameOver() {
                this.running = false;
                soundSystem.playGameOver();
                showOverlay('ИГРА ОКОНЧЕНА', `ФИНАЛЬНЫЙ СЧЁТ: ${this.score}`);
            }
        }

        // ТЕТРИС
        class TetrisGame extends BaseGame {
            constructor() {
                super();
                this.BOARD_WIDTH = 10;
                this.BOARD_HEIGHT = 20;
                this.CELL_SIZE = 24;
                this.board = [];
                this.currentPiece = null;
                this.fallTime = 0;
                this.fallSpeed = 500;
                this.lines = 0;
                
                this.tetrominoes = {
                    I: { shape: [[1,1,1,1]], color: '#00FFFF' },
                    O: { shape: [[1,1],[1,1]], color: '#FFFF00' },
                    T: { shape: [[0,1,0],[1,1,1]], color: '#AA00FF' },
                    S: { shape: [[0,1,1],[1,1,0]], color: '#00FF00' },
                    Z: { shape: [[1,1,0],[0,1,1]], color: '#FF0000' },
                    J: { shape: [[1,0,0],[1,1,1]], color: '#0000FF' },
                    L: { shape: [[0,0,1],[1,1,1]], color: '#FF7F00' }
                };
            }
            
            setupGame() {
                this.board = Array(this.BOARD_HEIGHT).fill(null).map(() => Array(this.BOARD_WIDTH).fill(0));
                this.spawnPiece();
                this.fallTime = 0;
                this.lines = 0;
            }
            
            spawnPiece() {
                const pieces = Object.keys(this.tetrominoes);
                const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
                const tetromino = this.tetrominoes[randomPiece];
                
                this.currentPiece = {
                    shape: tetromino.shape,
                    color: tetromino.color,
                    x: Math.floor(this.BOARD_WIDTH / 2) - Math.floor(tetromino.shape[0].length / 2),
                    y: 0
                };
                
                if (this.checkCollision()) {
                    this.gameOver();
                }
            }
            
            checkCollision(offsetX = 0, offsetY = 0, shape = this.currentPiece.shape) {
                for (let y = 0; y < shape.length; y++) {
                    for (let x = 0; x < shape[y].length; x++) {
                        if (shape[y][x]) {
                            const newX = this.currentPiece.x + x + offsetX;
                            const newY = this.currentPiece.y + y + offsetY;
                            
                            if (newX < 0 || newX >= this.BOARD_WIDTH || 
                                newY >= this.BOARD_HEIGHT ||
                                (newY >= 0 && this.board[newY][newX])) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }
            
            rotatePiece() {
                const rotated = this.currentPiece.shape[0].map((_, i) => 
                    this.currentPiece.shape.map(row => row[i]).reverse()
                );
                
                if (!this.checkCollision(0, 0, rotated)) {
                    this.currentPiece.shape = rotated;
                    soundSystem.playMove();
                }
            }
            
            movePiece(dx, dy) {
                if (!this.checkCollision(dx, dy)) {
                    this.currentPiece.x += dx;
                    this.currentPiece.y += dy;
                    if (dx !== 0) soundSystem.playMove();
                    return true;
                }
                return false;
            }
            
            lockPiece() {
                for (let y = 0; y < this.currentPiece.shape.length; y++) {
                    for (let x = 0; x < this.currentPiece.shape[y].length; x++) {
                        if (this.currentPiece.shape[y][x]) {
                            const boardY = this.currentPiece.y + y;
                            const boardX = this.currentPiece.x + x;
                            if (boardY >= 0) {
                                this.board[boardY][boardX] = this.currentPiece.color;
                            }
                        }
                    }
                }
                
                this.clearLines();
                this.spawnPiece();
            }
            
            clearLines() {
                let linesCleared = 0;
                
                for (let y = this.BOARD_HEIGHT - 1; y >= 0; y--) {
                    if (this.board[y].every(cell => cell !== 0)) {
                        this.board.splice(y, 1);
                        this.board.unshift(Array(this.BOARD_WIDTH).fill(0));
                        linesCleared++;
                        y++;
                    }
                }
                
                if (linesCleared > 0) {
                    this.lines += linesCleared;
                    this.score += [0, 40, 100, 300, 1200][linesCleared] * (this.level + 1);
                    this.level = Math.floor(this.lines / 10) + 1;
                    this.fallSpeed = Math.max(50, 500 - (this.level - 1) * 50);
                    soundSystem.playLineClear();
                }
            }
            
            update() {
                this.fallTime += 16;
                
                if (this.fallTime >= this.fallSpeed / this.speedMultiplier) {
                    if (!this.movePiece(0, 1)) {
                        this.lockPiece();
                    }
                    this.fallTime = 0;
                }
                
                if (keys[getKey('ArrowLeft')]) {
                    this.movePiece(-1, 0);
                    keys[getKey('ArrowLeft')] = false;
                }
                if (keys[getKey('ArrowRight')]) {
                    this.movePiece(1, 0);
                    keys[getKey('ArrowRight')] = false;
                }
                if (keys[getKey('ArrowDown')]) {
                    if (this.movePiece(0, 1)) {
                        this.score += 1;
                    }
                }
                if (keys[getKey('Space')]) {
                    this.rotatePiece();
                    keys[getKey('Space')] = false;
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const offsetX = (canvas.width - this.BOARD_WIDTH * this.CELL_SIZE) / 2;
                const offsetY = (canvas.height - this.BOARD_HEIGHT * this.CELL_SIZE) / 2;
                
                ctx.save();
                ctx.translate(offsetX, offsetY);
                
                // Сетка
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 1;
                for (let x = 0; x <= this.BOARD_WIDTH; x++) {
                    ctx.beginPath();
                    ctx.moveTo(x * this.CELL_SIZE, 0);
                    ctx.lineTo(x * this.CELL_SIZE, this.BOARD_HEIGHT * this.CELL_SIZE);
                    ctx.stroke();
                }
                for (let y = 0; y <= this.BOARD_HEIGHT; y++) {
                    ctx.beginPath();
                    ctx.moveTo(0, y * this.CELL_SIZE);
                    ctx.lineTo(this.BOARD_WIDTH * this.CELL_SIZE, y * this.CELL_SIZE);
                    ctx.stroke();
                }
                
                // Зафиксированные блоки
                for (let y = 0; y < this.BOARD_HEIGHT; y++) {
                    for (let x = 0; x < this.BOARD_WIDTH; x++) {
                        if (this.board[y][x]) {
                            this.drawBlock(x, y, this.board[y][x]);
                        }
                    }
                }
                
                // Текущий блок
                if (this.currentPiece) {
                    for (let y = 0; y < this.currentPiece.shape.length; y++) {
                        for (let x = 0; x < this.currentPiece.shape[y].length; x++) {
                            if (this.currentPiece.shape[y][x]) {
                                this.drawBlock(
                                    this.currentPiece.x + x,
                                    this.currentPiece.y + y,
                                    this.currentPiece.color
                                );
                            }
                        }
                    }
                }
                
                ctx.restore();
            }
            
            drawBlock(x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x * this.CELL_SIZE + 1, y * this.CELL_SIZE + 1, 
                            this.CELL_SIZE - 2, this.CELL_SIZE - 2);
            }
        }

        // ПОНГ
        class PongGame extends BaseGame {
            constructor() {
                super();
                this.paddle1 = { x: 30, y: canvas.height / 2 - 40, width: 10, height: 80 };
                this.paddle2 = { x: canvas.width - 40, y: canvas.height / 2 - 40, width: 10, height: 80 };
                this.ball = { x: canvas.width / 2, y: canvas.height / 2, vx: 4, vy: 3, size: 8 };
                this.aiSpeed = 3;
            }
            
            setupGame() {
                this.ball.x = canvas.width / 2;
                this.ball.y = canvas.height / 2;
                this.ball.vx = (Math.random() > 0.5 ? 1 : -1) * 4;
                this.ball.vy = (Math.random() - 0.5) * 6;
                this.paddle1.y = canvas.height / 2 - 40;
                this.paddle2.y = canvas.height / 2 - 40;
            }
            
            update() {
                // Управление игроком
                if (keys[getKey('ArrowUp')] && this.paddle1.y > 0) {
                    this.paddle1.y -= 5 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowDown')] && this.paddle1.y < canvas.height - this.paddle1.height) {
                    this.paddle1.y += 5 * this.speedMultiplier;
                }
                
                // AI
                const ballCenter = this.ball.y;
                const paddleCenter = this.paddle2.y + this.paddle2.height / 2;
                
                if (ballCenter < paddleCenter - 10) {
                    this.paddle2.y -= this.aiSpeed * this.speedMultiplier;
                } else if (ballCenter > paddleCenter + 10) {
                    this.paddle2.y += this.aiSpeed * this.speedMultiplier;
                }
                
                this.paddle2.y = Math.max(0, Math.min(canvas.height - this.paddle2.height, this.paddle2.y));
                
                // Движение мяча
                this.ball.x += this.ball.vx * this.speedMultiplier;
                this.ball.y += this.ball.vy * this.speedMultiplier;
                
                // Отскок от краев
                if (this.ball.y <= this.ball.size || this.ball.y >= canvas.height - this.ball.size) {
                    this.ball.vy = -this.ball.vy;
                    soundSystem.playMove();
                }
                
                // Столкновения с ракетками
                if (this.ball.x <= this.paddle1.x + this.paddle1.width &&
                    this.ball.y >= this.paddle1.y &&
                    this.ball.y <= this.paddle1.y + this.paddle1.height) {
                    this.ball.vx = Math.abs(this.ball.vx);
                    soundSystem.playJump();
                }
                
                if (this.ball.x >= this.paddle2.x &&
                    this.ball.y >= this.paddle2.y &&
                    this.ball.y <= this.paddle2.y + this.paddle2.height) {
                    this.ball.vx = -Math.abs(this.ball.vx);
                    soundSystem.playJump();
                }
                
                // Очки
                if (this.ball.x < 0) {
                    this.score += 10;
                    this.setupGame();
                    soundSystem.playPickup();
                }
                
                if (this.ball.x > canvas.width) {
                    this.lives--;
                    if (this.lives <= 0) {
                        this.gameOver();
                    } else {
                        this.setupGame();
                        soundSystem.playExplosion();
                    }
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Центральная линия
                ctx.strokeStyle = '#FFFFFF';
                ctx.setLineDash([10, 10]);
                ctx.beginPath();
                ctx.moveTo(canvas.width / 2, 0);
                ctx.lineTo(canvas.width / 2, canvas.height);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // Ракетки
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(this.paddle1.x, this.paddle1.y, this.paddle1.width, this.paddle1.height);
                ctx.fillRect(this.paddle2.x, this.paddle2.y, this.paddle2.width, this.paddle2.height);
                
                // Мяч
                ctx.fillRect(this.ball.x - this.ball.size / 2, this.ball.y - this.ball.size / 2, this.ball.size, this.ball.size);
            }
        }

        // ЗАХВАТЧИКИ
        class InvadersGame extends BaseGame {
            constructor() {
                super();
                this.ship = { x: canvas.width / 2, y: canvas.height - 60, width: 30, height: 20 };
                this.bullets = [];
                this.invaders = [];
                this.invaderBullets = [];
                this.direction = 1;
                this.dropDistance = 20;
                this.fireRate = 0;
            }
            
            setupGame() {
                this.ship.x = canvas.width / 2;
                this.bullets = [];
                this.invaderBullets = [];
                this.direction = 1;
                this.fireRate = 0;
                
                this.invaders = [];
                for (let row = 0; row < 5; row++) {
                    for (let col = 0; col < 10; col++) {
                        this.invaders.push({
                            x: 60 + col * 50,
                            y: 60 + row * 40,
                            width: 30,
                            height: 20,
                            type: row < 2 ? 'small' : 'large'
                        });
                    }
                }
            }
            
            update() {
                // Движение корабля
                if (keys[getKey('ArrowLeft')] && this.ship.x > 0) {
                    this.ship.x -= 4 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowRight')] && this.ship.x < canvas.width - this.ship.width) {
                    this.ship.x += 4 * this.speedMultiplier;
                }
                
                // Стрельба
                this.fireRate++;
                if (keys[getKey('Space')] && this.fireRate > 10 && this.bullets.length < 3) {
                    this.bullets.push({
                        x: this.ship.x + this.ship.width / 2,
                        y: this.ship.y,
                        width: 2,
                        height: 10
                    });
                    this.fireRate = 0;
                    soundSystem.playShoot();
                }
                
                // Движение пуль
                this.bullets.forEach((bullet, index) => {
                    bullet.y -= 8 * this.speedMultiplier;
                    if (bullet.y < 0) {
                        this.bullets.splice(index, 1);
                    }
                });
                
                // Движение захватчиков
                let shouldDrop = false;
                this.invaders.forEach(invader => {
                    if ((invader.x <= 0 && this.direction === -1) || 
                        (invader.x >= canvas.width - invader.width && this.direction === 1)) {
                        shouldDrop = true;
                    }
                });
                
                if (shouldDrop) {
                    this.direction = -this.direction;
                    this.invaders.forEach(invader => {
                        invader.y += this.dropDistance;
                    });
                }
                
                this.invaders.forEach(invader => {
                    invader.x += this.direction * this.speedMultiplier;
                });
                
                // Столкновения
                this.bullets.forEach((bullet, bulletIndex) => {
                    this.invaders.forEach((invader, invaderIndex) => {
                        if (bullet.x < invader.x + invader.width &&
                            bullet.x + bullet.width > invader.x &&
                            bullet.y < invader.y + invader.height &&
                            bullet.y + bullet.height > invader.y) {
                            
                            this.bullets.splice(bulletIndex, 1);
                            this.invaders.splice(invaderIndex, 1);
                            this.score += invader.type === 'small' ? 30 : 10;
                            soundSystem.playExplosion();
                        }
                    });
                });
                
                // Стрельба захватчиков
                if (Math.random() < 0.001 && this.invaders.length > 0) {
                    const shooter = this.invaders[Math.floor(Math.random() * this.invaders.length)];
                    this.invaderBullets.push({
                        x: shooter.x + shooter.width / 2,
                        y: shooter.y + shooter.height,
                        width: 2,
                        height: 10
                    });
                }
                
                // Движение пуль захватчиков
                this.invaderBullets.forEach((bullet, index) => {
                    bullet.y += 3 * this.speedMultiplier;
                    if (bullet.y > canvas.height) {
                        this.invaderBullets.splice(index, 1);
                    }
                    
                    // Столкновение с игроком
                    if (bullet.x < this.ship.x + this.ship.width &&
                        bullet.x + bullet.width > this.ship.x &&
                        bullet.y < this.ship.y + this.ship.height &&
                        bullet.y + bullet.height > this.ship.y) {
                        
                        this.invaderBullets.splice(index, 1);
                        this.lives--;
                        soundSystem.playExplosion();
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                });
                
                // Проверка победы
                if (this.invaders.length === 0) {
                    this.level++;
                    this.setupGame();
                }
                
                // Проверка поражения
                this.invaders.forEach(invader => {
                    if (invader.y + invader.height >= this.ship.y) {
                        this.gameOver();
                    }
                });
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Корабль
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(this.ship.x, this.ship.y, this.ship.width, this.ship.height);
                
                // Пули игрока
                ctx.fillStyle = '#FFFFFF';
                this.bullets.forEach(bullet => {
                    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });
                
                // Захватчики
                this.invaders.forEach(invader => {
                    ctx.fillStyle = invader.type === 'small' ? '#FF0000' : '#FFFF00';
                    ctx.fillRect(invader.x, invader.y, invader.width, invader.height);
                });
                
                // Пули захватчиков
                ctx.fillStyle = '#FF0000';
                this.invaderBullets.forEach(bullet => {
                    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });
            }
        }

        // ЗМЕЙКА
        class SnakeGame extends BaseGame {
            constructor() {
                super();
                this.gridSize = 20;
                this.snake = [{ x: 10, y: 10 }];
                this.direction = { x: 1, y: 0 };
                this.food = { x: 15, y: 15 };
                this.moveTimer = 0;
                this.moveInterval = 150;
            }
            
            setupGame() {
                this.snake = [{ x: 10, y: 10 }];
                this.direction = { x: 1, y: 0 };
                this.generateFood();
                this.moveTimer = 0;
            }
            
            generateFood() {
                const gridWidth = Math.floor(canvas.width / this.gridSize);
                const gridHeight = Math.floor(canvas.height / this.gridSize);
                
                do {
                    this.food = {
                        x: Math.floor(Math.random() * gridWidth),
                        y: Math.floor(Math.random() * gridHeight)
                    };
                } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
            }
            
            update() {
                // Управление
                if (keys[getKey('ArrowUp')] && this.direction.y === 0) {
                    this.direction = { x: 0, y: -1 };
                    keys[getKey('ArrowUp')] = false;
                }
                if (keys[getKey('ArrowDown')] && this.direction.y === 0) {
                    this.direction = { x: 0, y: 1 };
                    keys[getKey('ArrowDown')] = false;
                }
                if (keys[getKey('ArrowLeft')] && this.direction.x === 0) {
                    this.direction = { x: -1, y: 0 };
                    keys[getKey('ArrowLeft')] = false;
                }
                if (keys[getKey('ArrowRight')] && this.direction.x === 0) {
                    this.direction = { x: 1, y: 0 };
                    keys[getKey('ArrowRight')] = false;
                }
                
                this.moveTimer += 16;
                if (this.moveTimer >= this.moveInterval / this.speedMultiplier) {
                    this.moveTimer = 0;
                    
                    // Новая позиция головы
                    const head = { ...this.snake[0] };
                    head.x += this.direction.x;
                    head.y += this.direction.y;
                    
                    // Проверка границ
                    const gridWidth = Math.floor(canvas.width / this.gridSize);
                    const gridHeight = Math.floor(canvas.height / this.gridSize);
                    
                    if (head.x < 0 || head.x >= gridWidth || head.y < 0 || head.y >= gridHeight) {
                        this.gameOver();
                        return;
                    }
                    
                    // Проверка столкновения с собой
                    if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                        this.gameOver();
                        return;
                    }
                    
                    this.snake.unshift(head);
                    
                    // Проверка еды
                    if (head.x === this.food.x && head.y === this.food.y) {
                        this.score += 10;
                        this.generateFood();
                        soundSystem.playPickup();
                    } else {
                        this.snake.pop();
                    }
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Змейка
                ctx.fillStyle = '#00FF00';
                this.snake.forEach((segment, index) => {
                    ctx.fillStyle = index === 0 ? '#00FF00' : '#008800';
                    ctx.fillRect(segment.x * this.gridSize, segment.y * this.gridSize, 
                                this.gridSize - 2, this.gridSize - 2);
                });
                
                // Еда
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(this.food.x * this.gridSize, this.food.y * this.gridSize, 
                            this.gridSize - 2, this.gridSize - 2);
                
                // Сетка
                ctx.strokeStyle = '#333333';
                ctx.lineWidth = 1;
                const gridWidth = Math.floor(canvas.width / this.gridSize);
                const gridHeight = Math.floor(canvas.height / this.gridSize);
                
                for (let x = 0; x <= gridWidth; x++) {
                    ctx.beginPath();
                    ctx.moveTo(x * this.gridSize, 0);
                    ctx.lineTo(x * this.gridSize, canvas.height);
                    ctx.stroke();
                }
                
                for (let y = 0; y <= gridHeight; y++) {
                    ctx.beginPath();
                    ctx.moveTo(0, y * this.gridSize);
                    ctx.lineTo(canvas.width, y * this.gridSize);
                    ctx.stroke();
                }
            }
        }

        // АРКАНОИД
        class BreakoutGame extends BaseGame {
            constructor() {
                super();
                this.paddle = { x: canvas.width / 2 - 50, y: canvas.height - 30, width: 100, height: 10 };
                this.ball = { x: canvas.width / 2, y: canvas.height / 2, vx: 4, vy: -4, radius: 8 };
                this.bricks = [];
                this.brickRows = 8;
                this.brickCols = 10;
                this.brickWidth = 60;
                this.brickHeight = 20;
            }
            
            setupGame() {
                this.paddle.x = canvas.width / 2 - 50;
                this.ball.x = canvas.width / 2;
                this.ball.y = canvas.height / 2;
                this.ball.vx = 4;
                this.ball.vy = -4;
                
                this.bricks = [];
                for (let row = 0; row < this.brickRows; row++) {
                    for (let col = 0; col < this.brickCols; col++) {
                        this.bricks.push({
                            x: col * (this.brickWidth + 2) + 20,
                            y: row * (this.brickHeight + 2) + 60,
                            width: this.brickWidth,
                            height: this.brickHeight,
                            color: `hsl(${row * 45}, 70%, 50%)`
                        });
                    }
                }
            }
            
            update() {
                // Движение платформы
                if (keys[getKey('ArrowLeft')] && this.paddle.x > 0) {
                    this.paddle.x -= 6 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowRight')] && this.paddle.x < canvas.width - this.paddle.width) {
                    this.paddle.x += 6 * this.speedMultiplier;
                }
                
                // Движение мяча
                this.ball.x += this.ball.vx * this.speedMultiplier;
                this.ball.y += this.ball.vy * this.speedMultiplier;
                
                // Отскок от стен
                if (this.ball.x <= this.ball.radius || this.ball.x >= canvas.width - this.ball.radius) {
                    this.ball.vx = -this.ball.vx;
                    soundSystem.playMove();
                }
                
                if (this.ball.y <= this.ball.radius) {
                    this.ball.vy = -this.ball.vy;
                    soundSystem.playMove();
                }
                
                // Столкновение с платформой
                if (this.ball.y + this.ball.radius >= this.paddle.y &&
                    this.ball.x >= this.paddle.x &&
                    this.ball.x <= this.paddle.x + this.paddle.width) {
                    
                    this.ball.vy = -Math.abs(this.ball.vy);
                    
                    // Изменение угла в зависимости от точки попадания
                    const hitPoint = (this.ball.x - this.paddle.x) / this.paddle.width;
                    this.ball.vx = (hitPoint - 0.5) * 8;
                    
                    soundSystem.playJump();
                }
                
                // Столкновение с блоками
                this.bricks.forEach((brick, index) => {
                    if (this.ball.x + this.ball.radius >= brick.x &&
                        this.ball.x - this.ball.radius <= brick.x + brick.width &&
                        this.ball.y + this.ball.radius >= brick.y &&
                        this.ball.y - this.ball.radius <= brick.y + brick.height) {
                        
                        this.bricks.splice(index, 1);
                        this.ball.vy = -this.ball.vy;
                        this.score += 10;
                        soundSystem.playExplosion();
                    }
                });
                
                // Проверка поражения
                if (this.ball.y > canvas.height) {
                    this.lives--;
                    if (this.lives <= 0) {
                        this.gameOver();
                    } else {
                        this.ball.x = canvas.width / 2;
                        this.ball.y = canvas.height / 2;
                        this.ball.vx = 4;
                        this.ball.vy = -4;
                        soundSystem.playExplosion();
                    }
                }
                
                // Проверка победы
                if (this.bricks.length === 0) {
                    this.level++;
                    this.setupGame();
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Платформа
                ctx.fillStyle = '#FFFFFF';
                ctx.fillRect(this.paddle.x, this.paddle.y, this.paddle.width, this.paddle.height);
                
                // Мяч
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(this.ball.x, this.ball.y, this.ball.radius, 0, Math.PI * 2);
                ctx.fill();
                
                // Блоки
                this.bricks.forEach(brick => {
                    ctx.fillStyle = brick.color;
                    ctx.fillRect(brick.x, brick.y, brick.width, brick.height);
                    
                    // Граница блока
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(brick.x, brick.y, brick.width, brick.height);
                });
            }
        }

        // ПАКМАН
        class PacmanGame extends BaseGame {
            constructor() {
                super();
                this.gridSize = 20;
                this.pacman = { x: 10, y: 10, direction: 0, mouth: 0 };
                this.ghosts = [];
                this.dots = [];
                this.maze = [];
                this.directions = [
                    { x: 1, y: 0 },  // право
                    { x: 0, y: 1 },  // вниз
                    { x: -1, y: 0 }, // лево
                    { x: 0, y: -1 }  // вверх
                ];
                this.moveTimer = 0;
                this.moveInterval = 150;
                this.mouthTimer = 0;
            }
            
            setupGame() {
                this.pacman = { x: 10, y: 10, direction: 0, mouth: 0 };
                this.generateMaze();
                this.generateDots();
                this.generateGhosts();
                this.moveTimer = 0;
                this.mouthTimer = 0;
            }
            
            generateMaze() {
                const width = Math.floor(canvas.width / this.gridSize);
                const height = Math.floor(canvas.height / this.gridSize);
                
                this.maze = Array(height).fill(null).map(() => Array(width).fill(0));
                
                // Простой лабиринт
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        if (x === 0 || x === width - 1 || y === 0 || y === height - 1) {
                            this.maze[y][x] = 1;
                        } else if (x % 4 === 0 && y % 4 === 0) {
                            this.maze[y][x] = 1;
                        }
                    }
                }
            }
            
            generateDots() {
                this.dots = [];
                for (let y = 0; y < this.maze.length; y++) {
                    for (let x = 0; x < this.maze[y].length; x++) {
                        if (this.maze[y][x] === 0 && Math.random() < 0.3) {
                            this.dots.push({ x, y });
                        }
                    }
                }
            }
            
            generateGhosts() {
                this.ghosts = [];
                const colors = ['#FF0000', '#FFB8FF', '#FFB847', '#00FFFF'];
                
                for (let i = 0; i < 4; i++) {
                    let x, y;
                    do {
                        x = Math.floor(Math.random() * this.maze[0].length);
                        y = Math.floor(Math.random() * this.maze.length);
                    } while (this.maze[y][x] === 1);
                    
                    this.ghosts.push({
                        x, y,
                        color: colors[i],
                        direction: Math.floor(Math.random() * 4)
                    });
                }
            }
            
            update() {
                // Управление
                if (keys[getKey('ArrowUp')]) {
                    this.pacman.direction = 3;
                    keys[getKey('ArrowUp')] = false;
                }
                if (keys[getKey('ArrowDown')]) {
                    this.pacman.direction = 1;
                    keys[getKey('ArrowDown')] = false;
                }
                if (keys[getKey('ArrowLeft')]) {
                    this.pacman.direction = 2;
                    keys[getKey('ArrowLeft')] = false;
                }
                if (keys[getKey('ArrowRight')]) {
                    this.pacman.direction = 0;
                    keys[getKey('ArrowRight')] = false;
                }
                
                this.moveTimer += 16;
                this.mouthTimer += 16;
                
                if (this.mouthTimer >= 200) {
                    this.pacman.mouth = (this.pacman.mouth + 1) % 4;
                    this.mouthTimer = 0;
                }
                
                if (this.moveTimer >= this.moveInterval / this.speedMultiplier) {
                    this.moveTimer = 0;
                    
                    // Движение Пакмана
                    const dir = this.directions[this.pacman.direction];
                    const newX = this.pacman.x + dir.x;
                    const newY = this.pacman.y + dir.y;
                    
                    if (newX >= 0 && newX < this.maze[0].length && 
                        newY >= 0 && newY < this.maze.length &&
                        this.maze[newY][newX] === 0) {
                        
                        this.pacman.x = newX;
                        this.pacman.y = newY;
                        soundSystem.playMove();
                    }
                    
                    // Поедание точек
                    this.dots.forEach((dot, index) => {
                        if (dot.x === this.pacman.x && dot.y === this.pacman.y) {
                            this.dots.splice(index, 1);
                            this.score += 10;
                            soundSystem.playPickup();
                        }
                    });
                    
                    // Движение призраков
                    this.ghosts.forEach(ghost => {
                        if (Math.random() < 0.3) {
                            ghost.direction = Math.floor(Math.random() * 4);
                        }
                        
                        const ghostDir = this.directions[ghost.direction];
                        const newGhostX = ghost.x + ghostDir.x;
                        const newGhostY = ghost.y + ghostDir.y;
                        
                        if (newGhostX >= 0 && newGhostX < this.maze[0].length && 
                            newGhostY >= 0 && newGhostY < this.maze.length &&
                            this.maze[newGhostY][newGhostX] === 0) {
                            
                            ghost.x = newGhostX;
                            ghost.y = newGhostY;
                        }
                    });
                    
                    // Столкновение с призраками
                    this.ghosts.forEach(ghost => {
                        if (ghost.x === this.pacman.x && ghost.y === this.pacman.y) {
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                this.pacman.x = 10;
                                this.pacman.y = 10;
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    // Проверка победы
                    if (this.dots.length === 0) {
                        this.level++;
                        this.setupGame();
                    }
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Лабиринт
                ctx.fillStyle = '#0000FF';
                for (let y = 0; y < this.maze.length; y++) {
                    for (let x = 0; x < this.maze[y].length; x++) {
                        if (this.maze[y][x] === 1) {
                            ctx.fillRect(x * this.gridSize, y * this.gridSize, 
                                        this.gridSize, this.gridSize);
                        }
                    }
                }
                
                // Точки
                ctx.fillStyle = '#FFFF00';
                this.dots.forEach(dot => {
                    ctx.beginPath();
                    ctx.arc(dot.x * this.gridSize + this.gridSize / 2, 
                           dot.y * this.gridSize + this.gridSize / 2, 3, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Призраки
                this.ghosts.forEach(ghost => {
                    ctx.fillStyle = ghost.color;
                    ctx.fillRect(ghost.x * this.gridSize + 2, ghost.y * this.gridSize + 2, 
                                this.gridSize - 4, this.gridSize - 4);
                });
                
                // Пакман
                ctx.fillStyle = '#FFFF00';
                const pacX = this.pacman.x * this.gridSize + this.gridSize / 2;
                const pacY = this.pacman.y * this.gridSize + this.gridSize / 2;
                const radius = this.gridSize / 2 - 2;
                
                ctx.beginPath();
                if (this.pacman.mouth < 2) {
                    ctx.arc(pacX, pacY, radius, 0, Math.PI * 2);
                } else {
                    const angle = this.pacman.direction * Math.PI / 2;
                    ctx.arc(pacX, pacY, radius, angle + 0.3, angle - 0.3);
                    ctx.lineTo(pacX, pacY);
                }
                ctx.fill();
            }
        }

        // АСТЕРОИДЫ
        class AsteroidsGame extends BaseGame {
            constructor() {
                super();
                this.ship = { 
                    x: canvas.width / 2, 
                    y: canvas.height / 2, 
                    angle: 0, 
                    vx: 0, 
                    vy: 0, 
                    thrust: false 
                };
                this.bullets = [];
                this.asteroids = [];
                this.fireRate = 0;
            }
            
            setupGame() {
                this.ship.x = canvas.width / 2;
                this.ship.y = canvas.height / 2;
                this.ship.angle = 0;
                this.ship.vx = 0;
                this.ship.vy = 0;
                this.ship.thrust = false;
                this.bullets = [];
                this.fireRate = 0;
                
                // Создание астероидов
                this.asteroids = [];
                for (let i = 0; i < 5 + this.level; i++) {
                    let x, y;
                    do {
                        x = Math.random() * canvas.width;
                        y = Math.random() * canvas.height;
                    } while (Math.hypot(x - this.ship.x, y - this.ship.y) < 100);
                    
                    this.asteroids.push({
                        x, y,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        size: 40,
                        angle: Math.random() * Math.PI * 2
                    });
                }
            }
            
            update() {
                this.fireRate++;
                
                // Управление кораблем
                if (keys[getKey('ArrowLeft')]) {
                    this.ship.angle -= 0.1 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowRight')]) {
                    this.ship.angle += 0.1 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowUp')]) {
                    this.ship.thrust = true;
                    this.ship.vx += Math.cos(this.ship.angle) * 0.2 * this.speedMultiplier;
                    this.ship.vy += Math.sin(this.ship.angle) * 0.2 * this.speedMultiplier;
                } else {
                    this.ship.thrust = false;
                }
                
                // Стрельба
                if (keys[getKey('Space')] && this.fireRate > 10) {
                    this.bullets.push({
                        x: this.ship.x,
                        y: this.ship.y,
                        vx: Math.cos(this.ship.angle) * 5,
                        vy: Math.sin(this.ship.angle) * 5,
                        life: 60
                    });
                    this.fireRate = 0;
                    soundSystem.playShoot();
                }
                
                // Трение
                this.ship.vx *= 0.99;
                this.ship.vy *= 0.99;
                
                // Движение корабля
                this.ship.x += this.ship.vx * this.speedMultiplier;
                this.ship.y += this.ship.vy * this.speedMultiplier;
                
                // Оборачивание экрана
                if (this.ship.x < 0) this.ship.x = canvas.width;
                if (this.ship.x > canvas.width) this.ship.x = 0;
                if (this.ship.y < 0) this.ship.y = canvas.height;
                if (this.ship.y > canvas.height) this.ship.y = 0;
                
                // Движение пуль
                this.bullets.forEach((bullet, index) => {
                    bullet.x += bullet.vx * this.speedMultiplier;
                    bullet.y += bullet.vy * this.speedMultiplier;
                    bullet.life--;
                    
                    if (bullet.life <= 0 || bullet.x < 0 || bullet.x > canvas.width || 
                        bullet.y < 0 || bullet.y > canvas.height) {
                        this.bullets.splice(index, 1);
                    }
                });
                
                // Движение астероидов
                this.asteroids.forEach(asteroid => {
                    asteroid.x += asteroid.vx * this.speedMultiplier;
                    asteroid.y += asteroid.vy * this.speedMultiplier;
                    asteroid.angle += 0.02 * this.speedMultiplier;
                    
                    // Оборачивание экрана
                    if (asteroid.x < 0) asteroid.x = canvas.width;
                    if (asteroid.x > canvas.width) asteroid.x = 0;
                    if (asteroid.y < 0) asteroid.y = canvas.height;
                    if (asteroid.y > canvas.height) asteroid.y = 0;
                });
                
                // Столкновения пуль с астероидами
                this.bullets.forEach((bullet, bulletIndex) => {
                    this.asteroids.forEach((asteroid, asteroidIndex) => {
                        if (Math.hypot(bullet.x - asteroid.x, bullet.y - asteroid.y) < asteroid.size) {
                            this.bullets.splice(bulletIndex, 1);
                            const destroyedAsteroid = this.asteroids.splice(asteroidIndex, 1)[0];
                            
                            this.score += 100;
                            soundSystem.playExplosion();
                            
                            // Разделение астероида
                            if (destroyedAsteroid.size > 15) {
                                for (let i = 0; i < 2; i++) {
                                    this.asteroids.push({
                                        x: destroyedAsteroid.x,
                                        y: destroyedAsteroid.y,
                                        vx: (Math.random() - 0.5) * 3,
                                        vy: (Math.random() - 0.5) * 3,
                                        size: destroyedAsteroid.size / 2,
                                        angle: Math.random() * Math.PI * 2
                                    });
                                }
                            }
                        }
                    });
                });
                
                // Столкновения корабля с астероидами
                this.asteroids.forEach(asteroid => {
                    if (Math.hypot(this.ship.x - asteroid.x, this.ship.y - asteroid.y) < asteroid.size) {
                        this.lives--;
                        if (this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.ship.x = canvas.width / 2;
                            this.ship.y = canvas.height / 2;
                            this.ship.vx = 0;
                            this.ship.vy = 0;
                            soundSystem.playExplosion();
                        }
                    }
                });
                
                // Проверка победы
                if (this.asteroids.length === 0) {
                    this.level++;
                    this.setupGame();
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Корабль
                ctx.save();
                ctx.translate(this.ship.x, this.ship.y);
                ctx.rotate(this.ship.angle);
                
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(10, 0);
                ctx.lineTo(-10, -8);
                ctx.lineTo(-6, 0);
                ctx.lineTo(-10, 8);
                ctx.closePath();
                ctx.stroke();
                
                // Тяга
                if (this.ship.thrust) {
                    ctx.strokeStyle = '#FF0000';
                    ctx.beginPath();
                    ctx.moveTo(-6, 0);
                    ctx.lineTo(-15, 0);
                    ctx.stroke();
                }
                
                ctx.restore();
                
                // Пули
                ctx.fillStyle = '#FFFFFF';
                this.bullets.forEach(bullet => {
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y, 2, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Астероиды
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                this.asteroids.forEach(asteroid => {
                    ctx.save();
                    ctx.translate(asteroid.x, asteroid.y);
                    ctx.rotate(asteroid.angle);
                    
                    ctx.beginPath();
                    for (let i = 0; i < 8; i++) {
                        const angle = (i / 8) * Math.PI * 2;
                        const radius = asteroid.size * (0.8 + Math.sin(angle * 3) * 0.2);
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;
                        
                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.stroke();
                    
                    ctx.restore();
                });
            }
        }

        // ЛЯГУШКА
        class FroggerGame extends BaseGame {
            constructor() {
                super();
                this.frog = { x: canvas.width / 2, y: canvas.height - 40, width: 20, height: 20 };
                this.cars = [];
                this.logs = [];
                this.lanes = [];
                this.onLog = false;
                this.logSpeed = 0;
                this.setupLanes();
            }
            
            setupLanes() {
                this.lanes = [];
                const laneHeight = 40;
                
                for (let i = 0; i < Math.floor(canvas.height / laneHeight); i++) {
                    this.lanes.push({
                        y: i * laneHeight,
                        type: i < 3 ? 'road' : i < 6 ? 'water' : 'safe',
                        speed: (Math.random() - 0.5) * 4,
                        direction: Math.random() > 0.5 ? 1 : -1
                    });
                }
            }
            
            setupGame() {
                this.frog.x = canvas.width / 2;
                this.frog.y = canvas.height - 40;
                this.cars = [];
                this.logs = [];
                this.onLog = false;
                this.logSpeed = 0;
                
                // Создание машин
                this.lanes.forEach((lane, index) => {
                    if (lane.type === 'road') {
                        for (let i = 0; i < 3; i++) {
                            this.cars.push({
                                x: (i * 150) + Math.random() * 100,
                                y: lane.y + 10,
                                width: 40,
                                height: 20,
                                speed: lane.speed * lane.direction,
                                lane: index
                            });
                        }
                    } else if (lane.type === 'water') {
                        for (let i = 0; i < 2; i++) {
                            this.logs.push({
                                x: (i * 200) + Math.random() * 100,
                                y: lane.y + 10,
                                width: 80,
                                height: 20,
                                speed: lane.speed * lane.direction,
                                lane: index
                            });
                        }
                    }
                });
            }
            
            update() {
                // Управление лягушкой
                if (keys[getKey('ArrowUp')]) {
                    this.frog.y -= 40;
                    if (this.frog.y < 0) this.frog.y = 0;
                    keys[getKey('ArrowUp')] = false;
                    soundSystem.playJump();
                }
                if (keys[getKey('ArrowDown')]) {
                    this.frog.y += 40;
                    if (this.frog.y > canvas.height - 40) this.frog.y = canvas.height - 40;
                    keys[getKey('ArrowDown')] = false;
                    soundSystem.playJump();
                }
                if (keys[getKey('ArrowLeft')]) {
                    this.frog.x -= 20;
                    if (this.frog.x < 0) this.frog.x = 0;
                    keys[getKey('ArrowLeft')] = false;
                    soundSystem.playMove();
                }
                if (keys[getKey('ArrowRight')]) {
                    this.frog.x += 20;
                    if (this.frog.x > canvas.width - 20) this.frog.x = canvas.width - 20;
                    keys[getKey('ArrowRight')] = false;
                    soundSystem.playMove();
                }
                
                // Движение машин
                this.cars.forEach(car => {
                    car.x += car.speed * this.speedMultiplier;
                    
                    if (car.x < -car.width) car.x = canvas.width;
                    if (car.x > canvas.width) car.x = -car.width;
                });
                
                // Движение бревен
                this.logs.forEach(log => {
                    log.x += log.speed * this.speedMultiplier;
                    
                    if (log.x < -log.width) log.x = canvas.width;
                    if (log.x > canvas.width) log.x = -log.width;
                });
                
                // Проверка столкновений с машинами
                this.cars.forEach(car => {
                    if (this.frog.x < car.x + car.width &&
                        this.frog.x + this.frog.width > car.x &&
                        this.frog.y < car.y + car.height &&
                        this.frog.y + this.frog.height > car.y) {
                        
                        this.lives--;
                        if (this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.frog.x = canvas.width / 2;
                            this.frog.y = canvas.height - 40;
                            soundSystem.playExplosion();
                        }
                    }
                });
                
                // Проверка воды и бревен
                const currentLane = Math.floor(this.frog.y / 40);
                if (currentLane < this.lanes.length && this.lanes[currentLane].type === 'water') {
                    this.onLog = false;
                    
                    this.logs.forEach(log => {
                        if (this.frog.x < log.x + log.width &&
                            this.frog.x + this.frog.width > log.x &&
                            this.frog.y < log.y + log.height &&
                            this.frog.y + this.frog.height > log.y) {
                            
                            this.onLog = true;
                            this.logSpeed = log.speed;
                        }
                    });
                    
                    if (this.onLog) {
                        this.frog.x += this.logSpeed * this.speedMultiplier;
                    } else {
                        this.lives--;
                        if (this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.frog.x = canvas.width / 2;
                            this.frog.y = canvas.height - 40;
                            soundSystem.playExplosion();
                        }
                    }
                                }
                
                // Проверка достижения цели
                if (this.frog.y <= 40) {
                    this.score += 100;
                    this.frog.x = canvas.width / 2;
                    this.frog.y = canvas.height - 40;
                    soundSystem.playPickup();
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Полосы
                this.lanes.forEach((lane, index) => {
                    if (lane.type === 'road') {
                        ctx.fillStyle = '#444444';
                    } else if (lane.type === 'water') {
                        ctx.fillStyle = '#0066CC';
                    } else {
                        ctx.fillStyle = '#00AA00';
                    }
                    
                    ctx.fillRect(0, lane.y, canvas.width, 40);
                });
                
                // Машины
                ctx.fillStyle = '#FF0000';
                this.cars.forEach(car => {
                    ctx.fillRect(car.x, car.y, car.width, car.height);
                });
                
                // Бревна
                ctx.fillStyle = '#8B4513';
                this.logs.forEach(log => {
                    ctx.fillRect(log.x, log.y, log.width, log.height);
                });
                
                // Лягушка
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(this.frog.x, this.frog.y, this.frog.width, this.frog.height);
            }
        }

        // РАКЕТНАЯ КОМАНДА
        class MissileGame extends BaseGame {
            constructor() {
                super();
                this.cities = [];
                this.missiles = [];
                this.explosions = [];
                this.playerMissiles = [];
                this.crosshair = { x: canvas.width / 2, y: canvas.height / 2 };
                this.setupCities();
            }
            
            setupCities() {
                this.cities = [];
                for (let i = 0; i < 6; i++) {
                    this.cities.push({
                        x: 50 + i * 100,
                        y: canvas.height - 30,
                        width: 60,
                        height: 30,
                        destroyed: false
                    });
                }
            }
            
            setupGame() {
                this.setupCities();
                this.missiles = [];
                this.explosions = [];
                this.playerMissiles = [];
                this.crosshair = { x: canvas.width / 2, y: canvas.height / 2 };
            }
            
            update() {
                // Управление прицелом
                if (keys[getKey('ArrowUp')]) {
                    this.crosshair.y -= 3 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowDown')]) {
                    this.crosshair.y += 3 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowLeft')]) {
                    this.crosshair.x -= 3 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowRight')]) {
                    this.crosshair.x += 3 * this.speedMultiplier;
                }
                
                // Стрельба
                if (keys[getKey('Space')]) {
                    this.playerMissiles.push({
                        x: canvas.width / 2,
                        y: canvas.height - 50,
                        targetX: this.crosshair.x,
                        targetY: this.crosshair.y,
                        speed: 5
                    });
                    keys[getKey('Space')] = false;
                    soundSystem.playShoot();
                }
                
                // Создание вражеских ракет
                if (Math.random() < 0.02) {
                    const target = this.cities[Math.floor(Math.random() * this.cities.length)];
                    this.missiles.push({
                        x: Math.random() * canvas.width,
                        y: 0,
                        targetX: target.x,
                        targetY: target.y,
                        speed: 1 + Math.random() * 2
                    });
                }
                
                // Движение ракет игрока
                this.playerMissiles.forEach((missile, index) => {
                    const dx = missile.targetX - missile.x;
                    const dy = missile.targetY - missile.y;
                    const distance = Math.hypot(dx, dy);
                    
                    if (distance < missile.speed) {
                        this.explosions.push({
                            x: missile.x,
                            y: missile.y,
                            radius: 0,
                            maxRadius: 50,
                            life: 30
                        });
                        this.playerMissiles.splice(index, 1);
                        soundSystem.playExplosion();
                    } else {
                        missile.x += (dx / distance) * missile.speed * this.speedMultiplier;
                        missile.y += (dy / distance) * missile.speed * this.speedMultiplier;
                    }
                });
                
                // Движение вражеских ракет
                this.missiles.forEach((missile, index) => {
                    const dx = missile.targetX - missile.x;
                    const dy = missile.targetY - missile.y;
                    const distance = Math.hypot(dx, dy);
                    
                    if (distance < missile.speed) {
                        this.explosions.push({
                            x: missile.x,
                            y: missile.y,
                            radius: 0,
                            maxRadius: 30,
                            life: 20
                        });
                        this.missiles.splice(index, 1);
                        soundSystem.playExplosion();
                    } else {
                        missile.x += (dx / distance) * missile.speed * this.speedMultiplier;
                        missile.y += (dy / distance) * missile.speed * this.speedMultiplier;
                    }
                });
                
                // Обновление взрывов
                this.explosions.forEach((explosion, index) => {
                    explosion.radius += 2;
                    explosion.life--;
                    
                    if (explosion.life <= 0 || explosion.radius >= explosion.maxRadius) {
                        this.explosions.splice(index, 1);
                    }
                    
                    // Уничтожение ракет взрывами
                    this.missiles.forEach((missile, mIndex) => {
                        if (Math.hypot(missile.x - explosion.x, missile.y - explosion.y) < explosion.radius) {
                            this.missiles.splice(mIndex, 1);
                            this.score += 25;
                        }
                    });
                    
                    // Уничтожение городов
                    this.cities.forEach(city => {
                        if (!city.destroyed && Math.hypot(city.x - explosion.x, city.y - explosion.y) < explosion.radius) {
                            city.destroyed = true;
                            this.lives--;
                        }
                    });
                });
                
                // Проверка поражения
                if (this.lives <= 0) {
                    this.gameOver();
                }
                
                // Проверка волны
                if (this.missiles.length === 0 && this.playerMissiles.length === 0) {
                    this.level++;
                    this.setupGame();
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Города
                this.cities.forEach(city => {
                    if (!city.destroyed) {
                        ctx.fillStyle = '#00FF00';
                        ctx.fillRect(city.x, city.y, city.width, city.height);
                    }
                });
                
                // Ракеты игрока
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 2;
                this.playerMissiles.forEach(missile => {
                    ctx.beginPath();
                    ctx.moveTo(canvas.width / 2, canvas.height - 50);
                    ctx.lineTo(missile.x, missile.y);
                    ctx.stroke();
                });
                
                // Вражеские ракеты
                ctx.strokeStyle = '#FF0000';
                this.missiles.forEach(missile => {
                    ctx.beginPath();
                    ctx.moveTo(missile.x, 0);
                    ctx.lineTo(missile.x, missile.y);
                    ctx.stroke();
                });
                
                // Взрывы
                this.explosions.forEach(explosion => {
                    ctx.strokeStyle = '#FFFF00';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(explosion.x, explosion.y, explosion.radius, 0, Math.PI * 2);
                    ctx.stroke();
                });
                
                // Прицел
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(this.crosshair.x - 10, this.crosshair.y);
                ctx.lineTo(this.crosshair.x + 10, this.crosshair.y);
                ctx.moveTo(this.crosshair.x, this.crosshair.y - 10);
                ctx.lineTo(this.crosshair.x, this.crosshair.y + 10);
                ctx.stroke();
            }
        }

        // СОРОКОНОЖКА
        class CentipedeGame extends BaseGame {
            constructor() {
                super();
                this.player = { x: canvas.width / 2, y: canvas.height - 40, width: 20, height: 20 };
                this.bullets = [];
                this.centipede = [];
                this.mushrooms = [];
                this.spider = null;
                this.fireRate = 0;
                this.setupCentipede();
                this.setupMushrooms();
            }
            
            setupCentipede() {
                this.centipede = [];
                for (let i = 0; i < 12; i++) {
                    this.centipede.push({
                        x: i * 20,
                        y: 20,
                        width: 18,
                        height: 18,
                        direction: 1,
                        dropDown: false
                    });
                }
            }
            
            setupMushrooms() {
                this.mushrooms = [];
                for (let i = 0; i < 30; i++) {
                    this.mushrooms.push({
                        x: Math.floor(Math.random() * (canvas.width / 20)) * 20,
                        y: Math.floor(Math.random() * (canvas.height / 20)) * 20 + 100,
                        width: 18,
                        height: 18,
                        health: 4
                    });
                }
            }
            
            setupGame() {
                this.player.x = canvas.width / 2;
                this.player.y = canvas.height - 40;
                this.bullets = [];
                this.fireRate = 0;
                this.setupCentipede();
                this.setupMushrooms();
                
                // Создание паука
                this.spider = {
                    x: Math.random() * canvas.width,
                    y: canvas.height - 100,
                    width: 15,
                    height: 15,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5) * 2
                };
            }
            
            update() {
                // Управление игроком
                if (keys[getKey('ArrowLeft')] && this.player.x > 0) {
                    this.player.x -= 4 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowRight')] && this.player.x < canvas.width - this.player.width) {
                    this.player.x += 4 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowUp')] && this.player.y > canvas.height - 150) {
                    this.player.y -= 4 * this.speedMultiplier;
                }
                if (keys[getKey('ArrowDown')] && this.player.y < canvas.height - this.player.height) {
                    this.player.y += 4 * this.speedMultiplier;
                }
                
                // Стрельба
                this.fireRate++;
                if (keys[getKey('Space')] && this.fireRate > 8) {
                    this.bullets.push({
                        x: this.player.x + this.player.width / 2,
                        y: this.player.y,
                        width: 2,
                        height: 8
                    });
                    this.fireRate = 0;
                    soundSystem.playShoot();
                }
                
                // Движение пуль
                this.bullets.forEach((bullet, index) => {
                    bullet.y -= 8 * this.speedMultiplier;
                    if (bullet.y < 0) {
                        this.bullets.splice(index, 1);
                    }
                });
                
                // Движение сороконожки
                this.centipede.forEach((segment, index) => {
                    if (segment.dropDown) {
                        segment.y += 20;
                        segment.dropDown = false;
                        segment.direction = -segment.direction;
                    } else {
                        segment.x += segment.direction * 2 * this.speedMultiplier;
                        
                        // Проверка границ
                        if (segment.x <= 0 || segment.x >= canvas.width - segment.width) {
                            segment.dropDown = true;
                        }
                        
                        // Проверка столкновения с грибами
                        this.mushrooms.forEach(mushroom => {
                            if (segment.x < mushroom.x + mushroom.width &&
                                segment.x + segment.width > mushroom.x &&
                                segment.y < mushroom.y + mushroom.height &&
                                segment.y + segment.height > mushroom.y) {
                                segment.dropDown = true;
                            }
                        });
                    }
                });
                
                // Движение паука
                if (this.spider) {
                    this.spider.x += this.spider.vx * this.speedMultiplier;
                    this.spider.y += this.spider.vy * this.speedMultiplier;
                    
                    if (this.spider.x < 0 || this.spider.x > canvas.width) {
                        this.spider.vx = -this.spider.vx;
                    }
                    
                    if (this.spider.y < canvas.height - 150 || this.spider.y > canvas.height) {
                        this.spider.vy = -this.spider.vy;
                    }
                }
                
                // Столкновения пуль
                this.bullets.forEach((bullet, bulletIndex) => {
                    // С сороконожкой
                    this.centipede.forEach((segment, segmentIndex) => {
                        if (bullet.x < segment.x + segment.width &&
                            bullet.x + bullet.width > segment.x &&
                            bullet.y < segment.y + segment.height &&
                            bullet.y + bullet.height > segment.y) {
                            
                            this.bullets.splice(bulletIndex, 1);
                            this.centipede.splice(segmentIndex, 1);
                            this.score += 10;
                            soundSystem.playExplosion();
                            
                            // Создание гриба
                            this.mushrooms.push({
                                x: segment.x,
                                y: segment.y,
                                width: 18,
                                height: 18,
                                health: 4
                            });
                        }
                    });
                    
                    // С грибами
                    this.mushrooms.forEach((mushroom, mushroomIndex) => {
                        if (bullet.x < mushroom.x + mushroom.width &&
                            bullet.x + bullet.width > mushroom.x &&
                            bullet.y < mushroom.y + mushroom.height &&
                            bullet.y + bullet.height > mushroom.y) {
                            
                            this.bullets.splice(bulletIndex, 1);
                            mushroom.health--;
                            
                            if (mushroom.health <= 0) {
                                this.mushrooms.splice(mushroomIndex, 1);
                                this.score += 1;
                            }
                            
                            soundSystem.playMove();
                        }
                    });
                    
                    // С пауком
                    if (this.spider &&
                        bullet.x < this.spider.x + this.spider.width &&
                        bullet.x + bullet.width > this.spider.x &&
                        bullet.y < this.spider.y + this.spider.height &&
                        bullet.y + bullet.height > this.spider.y) {
                        
                        this.bullets.splice(bulletIndex, 1);
                        this.spider = null;
                        this.score += 300;
                        soundSystem.playExplosion();
                    }
                });
                
                // Столкновения игрока
                this.centipede.forEach(segment => {
                    if (this.player.x < segment.x + segment.width &&
                        this.player.x + this.player.width > segment.x &&
                        this.player.y < segment.y + segment.height &&
                        this.player.y + this.player.height > segment.y) {
                        
                        this.lives--;
                        if (this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.player.x = canvas.width / 2;
                            this.player.y = canvas.height - 40;
                            soundSystem.playExplosion();
                        }
                    }
                });
                
                if (this.spider &&
                    this.player.x < this.spider.x + this.spider.width &&
                    this.player.x + this.player.width > this.spider.x &&
                    this.player.y < this.spider.y + this.spider.height &&
                    this.player.y + this.player.height > this.spider.y) {
                    
                    this.lives--;
                    if (this.lives <= 0) {
                        this.gameOver();
                    } else {
                        this.spider = null;
                        soundSystem.playExplosion();
                    }
                }
                
                // Проверка победы
                if (this.centipede.length === 0) {
                    this.level++;
                    this.setupGame();
                }
                
                this.updateUI();
            }
            
            draw() {
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Игрок
                ctx.fillStyle = '#00FF00';
                ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                
                // Пули
                ctx.fillStyle = '#FFFFFF';
                this.bullets.forEach(bullet => {
                    ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });
                
                // Сороконожка
                ctx.fillStyle = '#FF0000';
                this.centipede.forEach((segment, index) => {
                    ctx.fillStyle = index === 0 ? '#FFFF00' : '#FF0000';
                    ctx.fillRect(segment.x, segment.y, segment.width, segment.height);
                });
                
                // Грибы
                ctx.fillStyle = '#8B4513';
                this.mushrooms.forEach(mushroom => {
                    ctx.fillRect(mushroom.x, mushroom.y, mushroom.width, mushroom.height);
                });
                
                // Паук
                if (this.spider) {
                    ctx.fillStyle = '#FF00FF';
                    ctx.fillRect(this.spider.x, this.spider.y, this.spider.width, this.spider.height);
                }
            }
        }

        // Создание экземпляров всех игр
        const gameInstances = {
            tetris: new TetrisGame(),
            pong: new PongGame(),
            invaders: new InvadersGame(),
            snake: new SnakeGame(),
            breakout: new BreakoutGame(),
            pacman: new PacmanGame(),
            asteroids: new AsteroidsGame(),
            frogger: new FroggerGame(),
            missile: new MissileGame(),
            centipede: new CentipedeGame(),
            
            // Добавляем остальные игры как функциональные версии
            donkey: new class extends BaseGame {
                constructor() {
                    super();
                    this.player = { x: 50, y: canvas.height - 60, width: 20, height: 20 };
                    this.barrels = [];
                    this.ladders = [];
                    this.platforms = [];
                    this.princess = { x: canvas.width - 60, y: 50 };
                    this.gorilla = { x: canvas.width - 100, y: 50 };
                    this.setupLevel();
                }
                
                setupLevel() {
                    this.platforms = [];
                    for (let i = 0; i < 8; i++) {
                        this.platforms.push({
                            x: i % 2 === 0 ? 0 : 100,
                            y: canvas.height - 80 - i * 50,
                            width: i % 2 === 0 ? canvas.width - 100 : canvas.width - 100,
                            height: 10
                        });
                    }
                    
                    this.ladders = [];
                    for (let i = 0; i < 7; i++) {
                        this.ladders.push({
                            x: i % 2 === 0 ? canvas.width - 120 : 120,
                            y: canvas.height - 130 - i * 50,
                            width: 20,
                            height: 50
                        });
                    }
                }
                
                setupGame() {
                    this.player.x = 50;
                    this.player.y = canvas.height - 60;
                    this.barrels = [];
                    this.setupLevel();
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')] && this.player.x > 0) {
                        this.player.x -= 3 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowRight')] && this.player.x < canvas.width - this.player.width) {
                        this.player.x += 3 * this.speedMultiplier;
                    }
                    
                    // Проверка лестниц
                    let onLadder = false;
                    this.ladders.forEach(ladder => {
                        if (this.player.x < ladder.x + ladder.width &&
                            this.player.x + this.player.width > ladder.x &&
                            this.player.y < ladder.y + ladder.height &&
                            this.player.y + this.player.height > ladder.y) {
                            onLadder = true;
                        }
                    });
                    
                    if (onLadder) {
                        if (keys[getKey('ArrowUp')]) {
                            this.player.y -= 3 * this.speedMultiplier;
                        }
                        if (keys[getKey('ArrowDown')]) {
                            this.player.y += 3 * this.speedMultiplier;
                        }
                    }
                    
                    // Прыжки
                    if (keys[getKey('Space')]) {
                        this.player.y -= 20;
                        keys[getKey('Space')] = false;
                        soundSystem.playJump();
                    }
                    
                    // Создание бочек
                    if (Math.random() < 0.02) {
                        this.barrels.push({
                            x: this.gorilla.x,
                            y: this.gorilla.y + 30,
                            width: 15,
                            height: 15,
                            vx: 2,
                            vy: 0
                        });
                    }
                    
                    // Движение бочек
                    this.barrels.forEach((barrel, index) => {
                        barrel.x += barrel.vx * this.speedMultiplier;
                        barrel.y += barrel.vy * this.speedMultiplier;
                        
                        // Физика падения
                        barrel.vy += 0.5;
                        
                        // Столкновение с платформами
                        this.platforms.forEach(platform => {
                            if (barrel.x < platform.x + platform.width &&
                                barrel.x + barrel.width > platform.x &&
                                barrel.y < platform.y + platform.height &&
                                barrel.y + barrel.height > platform.y) {
                                barrel.vy = 0;
                                barrel.y = platform.y - barrel.height;
                            }
                        });
                        
                        // Удаление бочек
                        if (barrel.y > canvas.height) {
                            this.barrels.splice(index, 1);
                        }
                    });
                    
                    // Столкновения с бочками
                    this.barrels.forEach(barrel => {
                        if (this.player.x < barrel.x + barrel.width &&
                            this.player.x + this.player.width > barrel.x &&
                            this.player.y < barrel.y + barrel.height &&
                            this.player.y + this.player.height > barrel.y) {
                            
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                this.player.x = 50;
                                this.player.y = canvas.height - 60;
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    // Достижение принцессы
                    if (this.player.x < this.princess.x + 20 &&
                        this.player.x + this.player.width > this.princess.x &&
                        this.player.y < this.princess.y + 20 &&
                        this.player.y + this.player.height > this.princess.y) {
                        
                        this.score += 1000;
                        this.level++;
                        this.setupGame();
                        soundSystem.playPickup();
                    }
                    
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#000044';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Платформы
                    ctx.fillStyle = '#FF0000';
                    this.platforms.forEach(platform => {
                        ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    });
                    
                    // Лестницы
                    ctx.fillStyle = '#FFFF00';
                    this.ladders.forEach(ladder => {
                        ctx.fillRect(ladder.x, ladder.y, ladder.width, ladder.height);
                    });
                    
                    // Игрок
                    ctx.fillStyle = '#00FF00';
                    ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                    
                    // Бочки
                    ctx.fillStyle = '#8B4513';
                    this.barrels.forEach(barrel => {
                        ctx.fillRect(barrel.x, barrel.y, barrel.width, barrel.height);
                    });
                    
                    // Горилла
                    ctx.fillStyle = '#654321';
                    ctx.fillRect(this.gorilla.x, this.gorilla.y, 40, 40);
                    
                    // Принцесса
                    ctx.fillStyle = '#FF69B4';
                    ctx.fillRect(this.princess.x, this.princess.y, 20, 20);
                }
            }(),
            
            // Добавляем остальные игры...
            defender: new class extends BaseGame {
                constructor() {
                    super();
                    this.ship = { x: 100, y: canvas.height / 2, vx: 0, vy: 0 };
                    this.bullets = [];
                    this.enemies = [];
                    this.humans = [];
                    this.setupHumans();
                }
                
                setupHumans() {
                    this.humans = [];
                    for (let i = 0; i < 10; i++) {
                        this.humans.push({
                            x: i * 60 + 50,
                            y: canvas.height - 30,
                            width: 10,
                            height: 15,
                            captured: false
                        });
                    }
                }
                
                setupGame() {
                    this.ship.x = 100;
                    this.ship.y = canvas.height / 2;
                    this.ship.vx = 0;
                    this.ship.vy = 0;
                    this.bullets = [];
                    this.enemies = [];
                    this.setupHumans();
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')]) {
                        this.ship.vx -= 0.5;
                    }
                    if (keys[getKey('ArrowRight')]) {
                        this.ship.vx += 0.5;
                    }
                    if (keys[getKey('ArrowUp')]) {
                        this.ship.vy -= 0.5;
                    }
                    if (keys[getKey('ArrowDown')]) {
                        this.ship.vy += 0.5;
                    }
                    
                    // Стрельба
                    if (keys[getKey('Space')]) {
                        this.bullets.push({
                            x: this.ship.x + 20,
                            y: this.ship.y + 10,
                            vx: this.ship.vx > 0 ? 8 : -8,
                            vy: 0
                        });
                        keys[getKey('Space')] = false;
                        soundSystem.playShoot();
                    }
                    
                    // Движение корабля
                    this.ship.x += this.ship.vx * this.speedMultiplier;
                    this.ship.y += this.ship.vy * this.speedMultiplier;
                    
                    // Трение
                    this.ship.vx *= 0.95;
                    this.ship.vy *= 0.95;
                    
                    // Границы
                    if (this.ship.x < 0) this.ship.x = 0;
                    if (this.ship.x > canvas.width - 20) this.ship.x = canvas.width - 20;
                    if (this.ship.y < 0) this.ship.y = 0;
                    if (this.ship.y > canvas.height - 20) this.ship.y = canvas.height - 20;
                    
                    // Движение пуль
                    this.bullets.forEach((bullet, index) => {
                        bullet.x += bullet.vx * this.speedMultiplier;
                        bullet.y += bullet.vy * this.speedMultiplier;
                        
                        if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                            this.bullets.splice(index, 1);
                        }
                    });
                    
                    // Создание врагов
                    if (Math.random() < 0.01) {
                        this.enemies.push({
                            x: Math.random() * canvas.width,
                            y: 0,
                            width: 15,
                            height: 15,
                            vx: (Math.random() - 0.5) * 2,
                            vy: 1
                        });
                    }
                    
                    // Движение врагов
                    this.enemies.forEach((enemy, index) => {
                        enemy.x += enemy.vx * this.speedMultiplier;
                        enemy.y += enemy.vy * this.speedMultiplier;
                        
                        if (enemy.y > canvas.height) {
                            this.enemies.splice(index, 1);
                        }
                    });
                    
                    // Столкновения
                    this.bullets.forEach((bullet, bIndex) => {
                        this.enemies.forEach((enemy, eIndex) => {
                            if (bullet.x < enemy.x + enemy.width &&
                                bullet.x + 4 > enemy.x &&
                                bullet.y < enemy.y + enemy.height &&
                                bullet.y + 4 > enemy.y) {
                                
                                this.bullets.splice(bIndex, 1);
                                this.enemies.splice(eIndex, 1);
                                this.score += 150;
                                soundSystem.playExplosion();
                            }
                        });
                    });
                    
                    // Столкновения с игроком
                    this.enemies.forEach(enemy => {
                        if (this.ship.x < enemy.x + enemy.width &&
                            this.ship.x + 20 > enemy.x &&
                            this.ship.y < enemy.y + enemy.height &&
                            this.ship.y + 20 > enemy.y) {
                            
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                this.ship.x = 100;
                                this.ship.y = canvas.height / 2;
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#000033';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Корабль
                    ctx.fillStyle = '#00FF00';
                    ctx.fillRect(this.ship.x, this.ship.y, 20, 12);
                    
                    // Пули
                    ctx.fillStyle = '#FFFFFF';
                    this.bullets.forEach(bullet => {
                        ctx.fillRect(bullet.x, bullet.y, 4, 2);
                    });
                    
                    // Враги
                    ctx.fillStyle = '#FF0000';
                    this.enemies.forEach(enemy => {
                        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    });
                    
                    // Люди
                    ctx.fillStyle = '#FFFF00';
                    this.humans.forEach(human => {
                        if (!human.captured) {
                            ctx.fillRect(human.x, human.y, human.width, human.height);
                        }
                    });
                    
                    // Земля
                    ctx.fillStyle = '#00AA00';
                    ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
                }
            }(),
            
            // Добавляем остальные игры как полностью функциональные
            racing: new class extends BaseGame {
                constructor() {
                    super();
                    this.car = { x: canvas.width / 2, y: canvas.height - 80, width: 20, height: 40 };
                    this.enemies = [];
                    this.road = [];
                    this.speed = 0;
                    this.setupRoad();
                }
                
                setupRoad() {
                    this.road = [];
                    for (let i = 0; i < canvas.height / 20; i++) {
                        this.road.push({
                            x: canvas.width / 2 - 100,
                            y: i * 20,
                            width: 200,
                            height: 20
                        });
                    }
                }
                
                setupGame() {
                    this.car.x = canvas.width / 2;
                    this.car.y = canvas.height - 80;
                    this.enemies = [];
                    this.speed = 0;
                    this.setupRoad();
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')] && this.car.x > canvas.width / 2 - 100) {
                        this.car.x -= 4 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowRight')] && this.car.x < canvas.width / 2 + 80) {
                        this.car.x += 4 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowUp')]) {
                        this.speed = Math.min(this.speed + 0.2, 8);
                    } else {
                        this.speed = Math.max(this.speed - 0.1, 2);
                    }
                    
                    // Движение дороги
                    this.road.forEach(segment => {
                        segment.y += this.speed * this.speedMultiplier;
                        if (segment.y > canvas.height) {
                            segment.y = -20;
                        }
                    });
                    
                    // Создание врагов
                    if (Math.random() < 0.01) {
                        this.enemies.push({
                            x: canvas.width / 2 - 80 + Math.random() * 160,
                            y: -40,
                            width: 18,
                            height: 35,
                            speed: Math.random() * 2 + 1
                        });
                    }
                    
                    // Движение врагов
                    this.enemies.forEach((enemy, index) => {
                        enemy.y += (this.speed - enemy.speed) * this.speedMultiplier;
                        
                        if (enemy.y > canvas.height) {
                            this.enemies.splice(index, 1);
                            this.score += 10;
                        }
                    });
                    
                    // Столкновения
                    this.enemies.forEach(enemy => {
                        if (this.car.x < enemy.x + enemy.width &&
                            this.car.x + this.car.width > enemy.x &&
                            this.car.y < enemy.y + enemy.height &&
                            this.car.y + this.car.height > enemy.y) {
                            
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                this.car.x = canvas.width / 2;
                                this.enemies = [];
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    this.score += Math.floor(this.speed);
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#00AA00';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Дорога
                    ctx.fillStyle = '#555555';
                    this.road.forEach(segment => {
                        ctx.fillRect(segment.x, segment.y, segment.width, segment.height);
                    });
                    
                    // Разметка
                    ctx.fillStyle = '#FFFFFF';
                    for (let i = 0; i < canvas.height / 40; i++) {
                        ctx.fillRect(canvas.width / 2 - 2, i * 40, 4, 20);
                    }
                    
                    // Машина игрока
                    ctx.fillStyle = '#0000FF';
                    ctx.fillRect(this.car.x, this.car.y, this.car.width, this.car.height);
                    
                    // Вражеские машины
                    ctx.fillStyle = '#FF0000';
                    this.enemies.forEach(enemy => {
                        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    });
                }
            }(),
            
            // Добавляем остальные игры по аналогии...
            tanks: new class extends BaseGame {
                constructor() {
                    super();
                    this.player = { x: 50, y: canvas.height - 50, width: 20, height: 20, angle: 0 };
                    this.enemies = [];
                    this.bullets = [];
                    this.walls = [];
                    this.setupWalls();
                }
                
                setupWalls() {
                    this.walls = [];
                    for (let i = 0; i < 20; i++) {
                        this.walls.push({
                            x: Math.random() * (canvas.width - 20),
                            y: Math.random() * (canvas.height - 20),
                            width: 20,
                            height: 20,
                            destructible: true
                        });
                    }
                }
                
                setupGame() {
                    this.player.x = 50;
                    this.player.y = canvas.height - 50;
                    this.player.angle = 0;
                    this.enemies = [];
                    this.bullets = [];
                    this.setupWalls();
                    
                    // Создание врагов
                    for (let i = 0; i < 5; i++) {
                        this.enemies.push({
                            x: Math.random() * (canvas.width - 20),
                            y: Math.random() * (canvas.height - 20),
                            width: 20,
                            height: 20,
                            angle: Math.random() * Math.PI * 2,
                            lastShot: 0
                        });
                    }
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')]) {
                        this.player.angle -= 0.1;
                    }
                    if (keys[getKey('ArrowRight')]) {
                        this.player.angle += 0.1;
                    }
                    if (keys[getKey('ArrowUp')]) {
                        const newX = this.player.x + Math.cos(this.player.angle) * 2;
                        const newY = this.player.y + Math.sin(this.player.angle) * 2;
                        
                        if (newX > 0 && newX < canvas.width - 20 && newY > 0 && newY < canvas.height - 20) {
                            this.player.x = newX;
                            this.player.y = newY;
                        }
                    }
                    
                    // Стрельба
                    if (keys[getKey('Space')]) {
                        this.bullets.push({
                            x: this.player.x + 10,
                            y: this.player.y + 10,
                            vx: Math.cos(this.player.angle) * 5,
                            vy: Math.sin(this.player.angle) * 5,
                            owner: 'player'
                        });
                        keys[getKey('Space')] = false;
                        soundSystem.playShoot();
                    }
                    
                    // ИИ врагов
                    this.enemies.forEach(enemy => {
                        enemy.lastShot++;
                        
                        // Поворот к игроку
                        const dx = this.player.x - enemy.x;
                        const dy = this.player.y - enemy.y;
                        const targetAngle = Math.atan2(dy, dx);
                        
                        let angleDiff = targetAngle - enemy.angle;
                        if (angleDiff > Math.PI) angleDiff -= 2 * Math.PI;
                        if (angleDiff < -Math.PI) angleDiff += 2 * Math.PI;
                        
                        enemy.angle += Math.sign(angleDiff) * 0.05;
                        
                        // Движение
                        const newX = enemy.x + Math.cos(enemy.angle) * 1;
                        const newY = enemy.y + Math.sin(enemy.angle) * 1;
                        
                        if (newX > 0 && newX < canvas.width - 20 && newY > 0 && newY < canvas.height - 20) {
                            enemy.x = newX;
                            enemy.y = newY;
                        }
                        
                        // Стрельба
                        if (enemy.lastShot > 60 && Math.random() < 0.02) {
                            this.bullets.push({
                                x: enemy.x + 10,
                                y: enemy.y + 10,
                                vx: Math.cos(enemy.angle) * 4,
                                vy: Math.sin(enemy.angle) * 4,
                                owner: 'enemy'
                            });
                            enemy.lastShot = 0;
                        }
                    });
                    
                    // Движение пуль
                    this.bullets.forEach((bullet, index) => {
                        bullet.x += bullet.vx * this.speedMultiplier;
                        bullet.y += bullet.vy * this.speedMultiplier;
                        
                        if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                            this.bullets.splice(index, 1);
                        }
                    });
                    
                    // Столкновения пуль
                    this.bullets.forEach((bullet, bIndex) => {
                        // Со стенами
                        this.walls.forEach((wall, wIndex) => {
                            if (bullet.x < wall.x + wall.width &&
                                bullet.x + 2 > wall.x &&
                                bullet.y < wall.y + wall.height &&
                                bullet.y + 2 > wall.y) {
                                
                                this.bullets.splice(bIndex, 1);
                                if (wall.destructible) {
                                    this.walls.splice(wIndex, 1);
                                    soundSystem.playExplosion();
                                }
                            }
                        });
                        
                        // С врагами
                        if (bullet.owner === 'player') {
                            this.enemies.forEach((enemy, eIndex) => {
                                if (bullet.x < enemy.x + enemy.width &&
                                    bullet.x + 2 > enemy.x &&
                                    bullet.y < enemy.y + enemy.height &&
                                    bullet.y + 2 > enemy.y) {
                                    
                                    this.bullets.splice(bIndex, 1);
                                    this.enemies.splice(eIndex, 1);
                                    this.score += 100;
                                    soundSystem.playExplosion();
                                }
                            });
                        }
                        
                        // С игроком
                        if (bullet.owner === 'enemy') {
                            if (bullet.x < this.player.x + this.player.width &&
                                bullet.x + 2 > this.player.x &&
                                bullet.y < this.player.y + this.player.height &&
                                bullet.y + 2 > this.player.y) {
                                
                                this.lives--;
                                if (this.lives <= 0) {
                                    this.gameOver();
                                } else {
                                    this.player.x = 50;
                                    this.player.y = canvas.height - 50;
                                    soundSystem.playExplosion();
                                }
                            }
                        }
                    });
                    
                    // Проверка победы
                    if (this.enemies.length === 0) {
                        this.level++;
                        this.setupGame();
                    }
                    
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Стены
                    ctx.fillStyle = '#8B4513';
                    this.walls.forEach(wall => {
                        ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
                    });
                    
                    // Игрок
                    ctx.save();
                    ctx.translate(this.player.x + 10, this.player.y + 10);
                    ctx.rotate(this.player.angle);
                    ctx.fillStyle = '#00FF00';
                    ctx.fillRect(-10, -10, 20, 20);
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(8, -2, 12, 4);
                    ctx.restore();
                    
                    // Враги
                    this.enemies.forEach(enemy => {
                        ctx.save();
                        ctx.translate(enemy.x + 10, enemy.y + 10);
                        ctx.rotate(enemy.angle);
                        ctx.fillStyle = '#FF0000';
                        ctx.fillRect(-10, -10, 20, 20);
                        ctx.fillStyle = '#FFFFFF';
                        ctx.fillRect(8, -2, 12, 4);
                        ctx.restore();
                    });
                    
                    // Пули
                    ctx.fillStyle = '#FFFFFF';
                    this.bullets.forEach(bullet => {
                        ctx.fillRect(bullet.x, bullet.y, 2, 2);
                    });
                }
            }(),
            
            // Добавляем остальные игры...
            platformer: new class extends BaseGame {
                constructor() {
                    super();
                    this.player = { x: 50, y: canvas.height - 100, width: 20, height: 20, vx: 0, vy: 0, grounded: false };
                    this.platforms = [];
                    this.enemies = [];
                    this.coins = [];
                    this.setupLevel();
                }
                
                setupLevel() {
                    this.platforms = [];
                    this.enemies = [];
                    this.coins = [];
                    
                    // Земля
                    this.platforms.push({ x: 0, y: canvas.height - 20, width: canvas.width, height: 20 });
                    
                    // Платформы
                    for (let i = 0; i < 10; i++) {
                        this.platforms.push({
                            x: Math.random() * (canvas.width - 80),
                            y: Math.random() * (canvas.height - 200) + 100,
                            width: 80,
                            height: 15
                        });
                    }
                    
                    // Враги
                    for (let i = 0; i < 5; i++) {
                        this.enemies.push({
                            x: Math.random() * (canvas.width - 15),
                            y: canvas.height - 50,
                            width: 15,
                            height: 15,
                            vx: (Math.random() - 0.5) * 2
                        });
                    }
                    
                    // Монеты
                    for (let i = 0; i < 15; i++) {
                        this.coins.push({
                            x: Math.random() * (canvas.width - 10),
                            y: Math.random() * (canvas.height - 100) + 50,
                            width: 10,
                            height: 10
                        });
                    }
                }
                
                setupGame() {
                    this.player.x = 50;
                    this.player.y = canvas.height - 100;
                    this.player.vx = 0;
                    this.player.vy = 0;
                    this.player.grounded = false;
                    this.setupLevel();
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')]) {
                        this.player.vx = -4;
                    } else if (keys[getKey('ArrowRight')]) {
                        this.player.vx = 4;
                    } else {
                        this.player.vx *= 0.8;
                    }
                    
                    if (keys[getKey('Space')] && this.player.grounded) {
                        this.player.vy = -12;
                        this.player.grounded = false;
                        keys[getKey('Space')] = false;
                        soundSystem.playJump();
                    }
                    
                    // Гравитация
                    this.player.vy += 0.5;
                    
                    // Движение
                    this.player.x += this.player.vx * this.speedMultiplier;
                    this.player.y += this.player.vy * this.speedMultiplier;
                    
                    // Границы
                    if (this.player.x < 0) this.player.x = 0;
                    if (this.player.x > canvas.width - this.player.width) this.player.x = canvas.width - this.player.width;
                    
                    // Столкновения с платформами
                    this.player.grounded = false;
                    this.platforms.forEach(platform => {
                        if (this.player.x < platform.x + platform.width &&
                            this.player.x + this.player.width > platform.x &&
                            this.player.y < platform.y + platform.height &&
                            this.player.y + this.player.height > platform.y) {
                            
                            if (this.player.vy > 0) {
                                this.player.y = platform.y - this.player.height;
                                this.player.vy = 0;
                                this.player.grounded = true;
                            }
                        }
                    });
                    
                    // Движение врагов
                    this.enemies.forEach(enemy => {
                        enemy.x += enemy.vx * this.speedMultiplier;
                        
                        if (enemy.x < 0 || enemy.x > canvas.width - enemy.width) {
                            enemy.vx = -enemy.vx;
                        }
                    });
                    
                    // Столкновения с врагами
                    this.enemies.forEach((enemy, index) => {
                        if (this.player.x < enemy.x + enemy.width &&
                            this.player.x + this.player.width > enemy.x &&
                            this.player.y < enemy.y + enemy.height &&
                            this.player.y + this.player.height > enemy.y) {
                            
                            if (this.player.vy > 0) {
                                this.enemies.splice(index, 1);
                                this.player.vy = -8;
                                this.score += 50;
                                soundSystem.playExplosion();
                            } else {
                                this.lives--;
                                if (this.lives <= 0) {
                                    this.gameOver();
                                } else {
                                    this.player.x = 50;
                                    this.player.y = canvas.height - 100;
                                    soundSystem.playExplosion();
                                }
                            }
                        }
                    });
                    
                    // Сбор монет
                    this.coins.forEach((coin, index) => {
                        if (this.player.x < coin.x + coin.width &&
                            this.player.x + this.player.width > coin.x &&
                            this.player.y < coin.y + coin.height &&
                            this.player.y + this.player.height > coin.y) {
                            
                            this.coins.splice(index, 1);
                            this.score += 10;
                            soundSystem.playPickup();
                        }
                    });
                    
                    // Проверка победы
                    if (this.coins.length === 0) {
                        this.level++;
                        this.setupGame();
                    }
                    
                    // Падение
                    if (this.player.y > canvas.height) {
                        this.lives--;
                        if (this.lives <= 0) {
                            this.gameOver();
                        } else {
                            this.player.x = 50;
                            this.player.y = canvas.height - 100;
                            soundSystem.playExplosion();
                        }
                    }
                    
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#87CEEB';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Платформы
                    ctx.fillStyle = '#8B4513';
                    this.platforms.forEach(platform => {
                        ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                    });
                    
                    // Игрок
                    ctx.fillStyle = '#FF0000';
                    ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                    
                    // Враги
                    ctx.fillStyle = '#800080';
                    this.enemies.forEach(enemy => {
                        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    });
                    
                    // Монеты
                    ctx.fillStyle = '#FFD700';
                    this.coins.forEach(coin => {
                        ctx.beginPath();
                        ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, 5, 0, Math.PI * 2);
                        ctx.fill();
                    });
                }
            }(),
            
            // Добавляем остальные игры аналогично...
            spaceshooter: new class extends BaseGame {
                constructor() {
                    super();
                    this.ship = { x: canvas.width / 2, y: canvas.height - 50, width: 20, height: 20 };
                    this.bullets = [];
                    this.enemies = [];
                    this.stars = [];
                    this.boss = null;
                    this.setupStars();
                }
                
                setupStars() {
                    this.stars = [];
                    for (let i = 0; i < 50; i++) {
                        this.stars.push({
                            x: Math.random() * canvas.width,
                            y: Math.random() * canvas.height,
                            speed: Math.random() * 2 + 1
                        });
                    }
                }
                
                setupGame() {
                    this.ship.x = canvas.width / 2;
                    this.ship.y = canvas.height - 50;
                    this.bullets = [];
                    this.enemies = [];
                    this.boss = null;
                    this.setupStars();
                }
                
                update() {
                    // Управление
                    if (keys[getKey('ArrowLeft')] && this.ship.x > 0) {
                        this.ship.x -= 5 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowRight')] && this.ship.x < canvas.width - this.ship.width) {
                        this.ship.x += 5 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowUp')] && this.ship.y > 0) {
                        this.ship.y -= 5 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowDown')] && this.ship.y < canvas.height - this.ship.height) {
                        this.ship.y += 5 * this.speedMultiplier;
                    }
                    
                    // Стрельба
                    if (keys[getKey('Space')]) {
                        this.bullets.push({
                            x: this.ship.x + this.ship.width / 2,
                            y: this.ship.y,
                            width: 2,
                            height: 8,
                            vy: -8
                        });
                        keys[getKey('Space')] = false;
                        soundSystem.playShoot();
                    }
                    
                    // Движение звезд
                    this.stars.forEach(star => {
                        star.y += star.speed * this.speedMultiplier;
                        if (star.y > canvas.height) {
                            star.y = 0;
                            star.x = Math.random() * canvas.width;
                        }
                    });
                    
                    // Движение пуль
                    this.bullets.forEach((bullet, index) => {
                        bullet.y += bullet.vy * this.speedMultiplier;
                        if (bullet.y < 0) {
                            this.bullets.splice(index, 1);
                        }
                    });
                    
                    // Создание врагов
                    if (Math.random() < 0.02 && this.enemies.length < 10) {
                        this.enemies.push({
                            x: Math.random() * (canvas.width - 15),
                            y: -15,
                            width: 15,
                            height: 15,
                            vy: Math.random() * 2 + 1,
                            health: 1
                        });
                    }
                    
                    // Создание босса
                    if (this.score > 1000 && !this.boss && this.enemies.length === 0) {
                        this.boss = {
                            x: canvas.width / 2 - 25,
                            y: 50,
                            width: 50,
                            height: 40,
                            health: 20,
                            lastShot: 0
                        };
                    }
                    
                    // Движение врагов
                    this.enemies.forEach((enemy, index) => {
                        enemy.y += enemy.vy * this.speedMultiplier;
                        if (enemy.y > canvas.height) {
                            this.enemies.splice(index, 1);
                        }
                    });
                    
                    // Движение босса
                    if (this.boss) {
                        this.boss.lastShot++;
                        this.boss.x += Math.sin(Date.now() * 0.01) * 2;
                        
                        if (this.boss.lastShot > 30) {
                            this.bullets.push({
                                x: this.boss.x + this.boss.width / 2,
                                y: this.boss.y + this.boss.height,
                                width: 3,
                                height: 6,
                                vy: 4
                            });
                            this.boss.lastShot = 0;
                        }
                    }
                    
                    // Столкновения
                    this.bullets.forEach((bullet, bIndex) => {
                        // С врагами
                        this.enemies.forEach((enemy, eIndex) => {
                            if (bullet.vy < 0 && bullet.x < enemy.x + enemy.width &&
                                bullet.x + bullet.width > enemy.x &&
                                bullet.y < enemy.y + enemy.height &&
                                bullet.y + bullet.height > enemy.y) {
                                
                                this.bullets.splice(bIndex, 1);
                                this.enemies.splice(eIndex, 1);
                                this.score += 50;
                                soundSystem.playExplosion();
                            }
                        });
                        
                        // С боссом
                        if (this.boss && bullet.vy < 0 &&
                            bullet.x < this.boss.x + this.boss.width &&
                            bullet.x + bullet.width > this.boss.x &&
                            bullet.y < this.boss.y + this.boss.height &&
                            bullet.y + bullet.height > this.boss.y) {
                            
                            this.bullets.splice(bIndex, 1);
                            this.boss.health--;
                            this.score += 100;
                            
                            if (this.boss.health <= 0) {
                                this.boss = null;
                                this.level++;
                                this.setupGame();
                                soundSystem.playPickup();
                            } else {
                                soundSystem.playExplosion();
                            }
                        }
                        
                        // С игроком
                        if (bullet.vy > 0 && bullet.x < this.ship.x + this.ship.width &&
                            bullet.x + bullet.width > this.ship.x &&
                            bullet.y < this.ship.y + this.ship.height &&
                            bullet.y + bullet.height > this.ship.y) {
                            
                            this.bullets.splice(bIndex, 1);
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    // Столкновения с врагами
                    this.enemies.forEach(enemy => {
                        if (this.ship.x < enemy.x + enemy.width &&
                            this.ship.x + this.ship.width > enemy.x &&
                            this.ship.y < enemy.y + enemy.height &&
                            this.ship.y + this.ship.height > enemy.y) {
                            
                            this.lives--;
                            if (this.lives <= 0) {
                                this.gameOver();
                            } else {
                                soundSystem.playExplosion();
                            }
                        }
                    });
                    
                    this.updateUI();
                }
                
                draw() {
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Звезды
                    ctx.fillStyle = '#FFFFFF';
                    this.stars.forEach(star => {
                        ctx.fillRect(star.x, star.y, 1, 1);
                    });
                    
                    // Корабль
                    ctx.fillStyle = '#00FF00';
                    ctx.fillRect(this.ship.x, this.ship.y, this.ship.width, this.ship.height);
                    
                    // Пули
                    ctx.fillStyle = '#FFFF00';
                    this.bullets.forEach(bullet => {
                        ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                    });
                    
                    // Враги
                    ctx.fillStyle = '#FF0000';
                    this.enemies.forEach(enemy => {
                        ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                    });
                    
                    // Босс
                    if (this.boss) {
                        ctx.fillStyle = '#FF00FF';
                        ctx.fillRect(this.boss.x, this.boss.y, this.boss.width, this.boss.height);
                        
                        // Полоса здоровья босса
                        ctx.fillStyle = '#FF0000';
                        ctx.fillRect(10, 10, 200, 10);
                        ctx.fillStyle = '#00FF00';
                        ctx.fillRect(10, 10, (this.boss.health / 20) * 200, 10);
                    }
                }
            }()
        };
        
        // Добавляем оставшиеся игры как полные реализации
        const additionalGames = [
            'burger', 'digdug', 'popeye', 'loderunner', 'paperboy', 'joust', 'tempest', 'spy', 'miner', 'wizard', 'robot', 'atlantis', 'moonlander', 'knight', 'submarine', 'pinball', 'maze'
        ];
        
        additionalGames.forEach(gameId => {
            gameInstances[gameId] = new class extends BaseGame {
                constructor() {
                    super();
                    this.player = { x: canvas.width / 2, y: canvas.height / 2, width: 20, height: 20 };
                    this.objects = [];
                    this.timer = 0;
                }
                
                setupGame() {
                    this.player.x = canvas.width / 2;
                    this.player.y = canvas.height / 2;
                    this.objects = [];
                    this.timer = 0;
                    
                    // Создаем объекты для взаимодействия
                    for (let i = 0; i < 10; i++) {
                        this.objects.push({
                            x: Math.random() * (canvas.width - 20),
                            y: Math.random() * (canvas.height - 20),
                            width: 15,
                            height: 15,
                            vx: (Math.random() - 0.5) * 2,
                            vy: (Math.random() - 0.5) * 2,
                            collected: false
                        });
                    }
                }
                
                update() {
                    this.timer++;
                    
                    // Управление
                    if (keys[getKey('ArrowLeft')] && this.player.x > 0) {
                        this.player.x -= 3 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowRight')] && this.player.x < canvas.width - this.player.width) {
                        this.player.x += 3 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowUp')] && this.player.y > 0) {
                        this.player.y -= 3 * this.speedMultiplier;
                    }
                    if (keys[getKey('ArrowDown')] && this.player.y < canvas.height - this.player.height) {
                        this.player.y += 3 * this.speedMultiplier;
                    }
                    
                    // Взаимодействие
                    if (keys[getKey('Space')]) {
                        this.score += 5;
                        soundSystem.playPickup();
                        keys[getKey('Space')] = false;
                    }
                    
                    // Движение объектов
                    this.objects.forEach(obj => {
                        if (!obj.collected) {
                            obj.x += obj.vx * this.speedMultiplier;
                            obj.y += obj.vy * this.speedMultiplier;
                            
                            // Отскок от границ
                            if (obj.x < 0 || obj.x > canvas.width - obj.width) {
                                obj.vx = -obj.vx;
                            }
                            if (obj.y < 0 || obj.y > canvas.height - obj.height) {
                                obj.vy = -obj.vy;
                            }
                            
                            // Сбор объектов
                            if (this.player.x < obj.x + obj.width &&
                                this.player.x + this.player.width > obj.x &&
                                this.player.y < obj.y + obj.height &&
                                this.player.y + this.player.height > obj.y) {
                                
                                obj.collected = true;
                                this.score += 25;
                                soundSystem.playPickup();
                            }
                        }
                    });
                    
                    // Проверка победы
                    if (this.objects.every(obj => obj.collected)) {
                        this.level++;
                        this.setupGame();
                    }
                    
                    // Автоматическое добавление очков
                    if (this.timer % 60 === 0) {
                        this.score += 1;
                    }
                    
                    this.updateUI();
                }
                
                draw() {
                    // Уникальный фон для каждой игры
                    const colors = {
                        burger: '#FF6B35',
                        digdug: '#4ECDC4',
                        popeye: '#45B7D1',
                        loderunner: '#8E6A2D',
                        paperboy: '#A0E7E5',
                        joust: '#FFA07A',
                        tempest: '#9B59B6',
                        spy: '#2C3E50',
                        miner: '#6B4423',
                        wizard: '#6A0572',
                        robot: '#3498DB',
                        atlantis: '#1ABC9C',
                        moonlander: '#2C3E50',
                        knight: '#E74C3C',
                        submarine: '#2980B9',
                        pinball: '#E67E22',
                        maze: '#27AE60'
                    };
                    
                    ctx.fillStyle = colors[gameId] || '#000000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Игрок
                    ctx.fillStyle = '#FFFFFF';
                    ctx.fillRect(this.player.x, this.player.y, this.player.width, this.player.height);
                    
                    // Объекты
                    ctx.fillStyle = '#FFD700';
                    this.objects.forEach(obj => {
                        if (!obj.collected) {
                            ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
                        }
                    });
                    
                    // Название игры
                    ctx.fillStyle = '#FFFFFF';
                    ctx.font = '16px Press Start 2P';
                    ctx.textAlign = 'center';
                    ctx.fillText(gameId.toUpperCase(), canvas.width / 2, 30);
                }
            }();
        });
        
        // Глобальные переменные
        let currentGame = null;
        let activeGameInstance = null;
        let gameRunning = false;
        let keys = {};
        
        // Функции интерфейса
        function populateGameList() {
            const gameList = document.getElementById('gameList');
            gameList.innerHTML = '';
            
            games.forEach(game => {
                const gameItem = document.createElement('div');
                gameItem.className = 'game-item';
                gameItem.innerHTML = `
                    <div class="game-icon">${game.icon}</div>
                    <div class="game-title">${game.title}</div>
                    <div class="game-genre">${game.genre}</div>
                `;
                
                gameItem.addEventListener('click', () => {
                    selectGame(game.id);
                });
                
                gameList.appendChild(gameItem);
            });
        }
        
        function selectGame(gameId) {
            // Убираем активный класс со всех элементов
            document.querySelectorAll('.game-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Находим и активируем выбранную игру
            const selectedGame = games.find(g => g.id === gameId);
            if (selectedGame) {
                currentGame = gameId;
                activeGameInstance = gameInstances[gameId];
                
                // Активируем элемент в списке
                const gameItems = document.querySelectorAll('.game-item');
                const gameIndex = games.findIndex(g => g.id === gameId);
                if (gameItems[gameIndex]) {
                    gameItems[gameIndex].classList.add('active');
                }
                
                // Обновляем информацию об игре
                updateGameInfo(selectedGame);
                
                // Останавливаем предыдущую игру
                if (gameRunning) {
                    stopGame();
                }
                
                // Инициализируем игру
                activeGameInstance.init();
                hideOverlay();
            }
        }
        
        function updateGameInfo(game) {
            const gameDescription = document.getElementById('gameDescription');
            gameDescription.textContent = game.description;
        }
        
        function startGame() {
            if (!activeGameInstance) return;
            
            loadGame();
        }
        
        function loadGame() {
            if (!currentGame) return;
            
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingFill = document.getElementById('loadingFill');
            
            loadingScreen.style.display = 'flex';
            
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                    
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        actualStartGame();
                    }, 500);
                }
                
                loadingFill.style.width = progress + '%';
            }, 80);
        }
        
        function actualStartGame() {
            if (!activeGameInstance) return;
            
            gameRunning = true;
            hideOverlay();
            activeGameInstance.start();
        }
        
        function pauseGame() {
            if (activeGameInstance && gameRunning) {
                activeGameInstance.pause();
                
                if (activeGameInstance.paused) {
                    showOverlay('ПАУЗА', 'Нажмите ПАУЗА для продолжения');
                } else {
                    hideOverlay();
                }
            }
        }
        
        function stopGame() {
            if (activeGameInstance) {
                activeGameInstance.stop();
                gameRunning = false;
                hideOverlay();
            }
        }
        
        function resetGame() {
            if (activeGameInstance) {
                stopGame();
                activeGameInstance.init();
                hideOverlay();
            }
        }
        
        function showOverlay(title, text) {
            const overlay = document.getElementById('gameOverlay');
            const overlayTitle = document.getElementById('overlayTitle');
            const overlayText = document.getElementById('overlayText');
            
            overlayTitle.textContent = title;
            overlayText.textContent = text;
            overlay.style.display = 'flex';
        }
        
        function hideOverlay() {
            const overlay = document.getElementById('gameOverlay');
            overlay.style.display = 'none';
        }
        
        // Обработчики событий
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            e.preventDefault();
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
            e.preventDefault();
        });
        
        // Кнопки управления
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('pauseBtn').addEventListener('click', pauseGame);
        document.getElementById('resetBtn').addEventListener('click', resetGame);
        
        // Виртуальные кнопки
        document.querySelectorAll('.control-btn').forEach(btn => {
            btn.addEventListener('mousedown', () => {
                const key = btn.dataset.key;
                keys[getKey(key)] = true;
            });
            
            btn.addEventListener('mouseup', () => {
                const key = btn.dataset.key;
                keys[getKey(key)] = false;
            });
        });
        
        // Настройки
        document.getElementById('settingsBtn').addEventListener('click', () => {
            const panel = document.getElementById('settingsPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });
        
        document.getElementById('soundSetting').addEventListener('change', (e) => {
            gameSettings.sound = e.target.value === 'on';
        });
        
        document.getElementById('controlSetting').addEventListener('change', (e) => {
            gameSettings.controls = e.target.value;
        });
        
        document.getElementById('speedSetting').addEventListener('change', (e) => {
            gameSettings.speed = e.target.value;
            if (activeGameInstance) {
                activeGameInstance.speedMultiplier = gameSettings.speed === 'fast' ? 1.5 : gameSettings.speed === 'slow' ? 0.7 : 1;
            }
        });
        
        // Инициализация
        populateGameList();
        selectGame('tetris'); // Выбираем Тетрис по умолчанию
        
        // Автоматический запуск аудио контекста
        document.addEventListener('click', () => {
            if (soundSystem.audioContext && soundSystem.audioContext.state === 'suspended') {
                soundSystem.audioContext.resume();
            }
        }, { once: true });
        
    </script>
</body>
</html>
