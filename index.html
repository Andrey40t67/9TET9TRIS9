<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>MegaConsole 30 - Ultimate Gaming Experience</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e, #0f3460);
            overflow: hidden;
            user-select: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        .console-container {
            display: flex;
            height: 100vh;
            background: #1a1a2a;
            position: relative;
        }
        
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #2a2a3a, #1a1a2a);
            border-right: 3px solid #00ff64;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .logo {
            padding: 20px;
            text-align: center;
            color: #00ff64;
            font-size: 14px;
            text-shadow: 0 0 20px #00ff64;
            border-bottom: 2px solid #00ff64;
            animation: logoGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            from { text-shadow: 0 0 20px #00ff64; }
            to { text-shadow: 0 0 40px #00ff64, 0 0 60px #00ff64; }
        }
        
        .game-carousel {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .game-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            color: #ffff64;
            font-size: 10px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ffff64;
            border-bottom: 1px solid #ffff64;
            padding-bottom: 5px;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .game-card {
            background: linear-gradient(45deg, #2a4a2a, #1a3a1a);
            border: 2px solid #00ff64;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .game-card:hover, .game-card.active {
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(0,255,100,0.6);
            background: linear-gradient(45deg, #3a5a3a, #2a4a2a);
        }
        
        .game-card.active {
            border-color: #ffff64;
            box-shadow: 0 0 25px rgba(255,255,100,0.8);
        }
        
        .game-icon {
            font-size: 20px;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .game-title {
            font-size: 7px;
            text-align: center;
            color: #00ff64;
            line-height: 1.2;
        }
        
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .game-display {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-canvas {
            border: 4px solid #00ff64;
            border-radius: 10px;
            box-shadow: 0 0 40px rgba(0,255,100,0.5);
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .controls-bar {
            height: 120px;
            background: linear-gradient(180deg, #2a2a3a, #1a1a2a);
            border-top: 3px solid #ff6464;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
        }
        
        .dpad {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 3px;
            width: 90px;
            height: 90px;
        }
        
        .dpad-btn {
            background: linear-gradient(45deg, #4a2a2a, #3a1a1a);
            border: 2px solid #ff6464;
            color: #ff6464;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        
        .dpad-btn:hover {
            background: linear-gradient(45deg, #5a3a3a, #4a2a2a);
            box-shadow: 0 0 10px rgba(255,100,100,0.5);
        }
        
        .dpad-btn:active {
            transform: scale(0.95);
            background: linear-gradient(45deg, #6a4a4a, #5a3a3a);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #2a2a4a, #1a1a3a);
            border: 3px solid #6464ff;
            color: #6464ff;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Press Start 2P';
        }
        
        .action-btn:hover {
            background: linear-gradient(45deg, #3a3a5a, #2a2a4a);
            box-shadow: 0 0 15px rgba(100,100,255,0.5);
        }
        
        .action-btn:active {
            transform: scale(0.9);
        }
        
        .system-controls {
            display: flex;
            gap: 8px;
        }
        
        .system-btn {
            padding: 8px 12px;
            background: linear-gradient(45deg, #4a4a2a, #3a3a1a);
            border: 2px solid #ffff64;
            color: #ffff64;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 8px;
            font-family: 'Press Start 2P';
        }
        
        .system-btn:hover {
            background: linear-gradient(45deg, #5a5a3a, #4a4a2a);
            box-shadow: 0 0 10px rgba(255,255,100,0.5);
        }
        
        .game-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 8px;
            color: #00ff64;
            font-size: 10px;
            max-width: 200px;
            border: 2px solid #00ff64;
        }
        
        .hud-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #ffff64;
            font-size: 12px;
            text-shadow: 0 0 10px #ffff64;
            z-index: 100;
        }
        
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-family: 'Orbitron', monospace;
            z-index: 200;
        }
        
        .overlay-title {
            font-size: 36px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #fff;
            animation: overlayPulse 2s ease-in-out infinite;
        }
        
        @keyframes overlayPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000, #222, #000);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #00ff64;
            font-family: 'Orbitron', monospace;
            z-index: 300;
        }
        
        .loading-bar {
            width: 400px;
            height: 20px;
            border: 2px solid #00ff64;
            border-radius: 10px;
            overflow: hidden;
            background: #000;
            margin-top: 20px;
        }
        
        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff64, #64ff64, #00ff64);
            width: 0%;
            transition: width 0.3s ease;
            animation: loadingShine 2s ease-in-out infinite;
        }
        
        @keyframes loadingShine {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            .console-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 3px solid #00ff64;
            }
            
            .game-carousel {
                overflow-x: auto;
                overflow-y: hidden;
            }
            
            .game-grid {
                display: flex;
                gap: 8px;
                padding-bottom: 10px;
            }
            
            .game-card {
                min-width: 80px;
                flex-shrink: 0;
            }
            
            .controls-bar {
                height: 100px;
                padding: 10px;
            }
            
            .dpad {
                width: 70px;
                height: 70px;
            }
            
            .action-btn {
                width: 40px;
                height: 40px;
                font-size: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                padding: 10px;
                font-size: 10px;
            }
            
            .controls-bar {
                height: 80px;
                padding: 8px;
            }
            
            .dpad {
                width: 60px;
                height: 60px;
            }
            
            .dpad-btn {
                font-size: 10px;
            }
            
            .action-btn {
                width: 35px;
                height: 35px;
                font-size: 7px;
            }
            
            .system-btn {
                padding: 6px 8px;
                font-size: 6px;
            }
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .particle-effect {
            position: absolute;
            pointer-events: none;
            z-index: 150;
        }
        
        .game-transition {
            animation: gameTransition 0.5s ease-in-out;
        }
        
        @keyframes gameTransition {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –¢–µ—Ç—Ä–∏—Å–∞ */
        .tetris-enhanced {
            filter: drop-shadow(0 0 10px #00ff64);
        }
        
        .combo-effect {
            position: absolute;
            color: #ffff00;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 20px #ffff00;
            animation: comboFloat 1s ease-out forwards;
            z-index: 100;
        }
        
        @keyframes comboFloat {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
        }
    </style>
</head>
<body>
    <div class="console-container">
        <div class="sidebar">
            <div class="logo">
                üéÆ MEGACONSOLE 30<br>
                ULTIMATE EDITION
            </div>
            
            <div class="game-carousel">
                <div class="game-category">
                    <div class="category-title">üß© –ö–õ–ê–°–°–ò–ß–ï–°–ö–ò–ï –ì–û–õ–û–í–û–õ–û–ú–ö–ò</div>
                    <div class="game-grid" id="puzzleGames"></div>
                </div>
                
                <div class="game-category">
                    <div class="category-title">üöó –ê–†–ö–ê–î–´ –ò –ì–û–ù–ö–ò</div>
                    <div class="game-grid" id="arcadeGames"></div>
                </div>
                
                <div class="game-category">
                    <div class="category-title">üöÄ –≠–ö–®–ù –ò –®–£–¢–ï–†–´</div>
                    <div class="game-grid" id="actionGames"></div>
                </div>
                
                <div class="game-category">
                    <div class="category-title">‚≠ê –ê–í–¢–û–†–°–ö–ò–ï –ù–û–í–ò–ù–ö–ò</div>
                    <div class="game-grid" id="originalGames"></div>
                </div>
            </div>
        </div>
        
        <div class="main-area">
            <div class="game-display">
                <canvas class="game-canvas" id="gameCanvas" width="800" height="600"></canvas>
                
                <div class="hud-overlay" id="gameHUD">
                    <div>SCORE: <span id="score">000000</span></div>
                    <div>LEVEL: <span id="level">01</span></div>
                    <div>LIVES: <span id="lives">3</span></div>
                </div>
                
                <div class="game-info" id="gameInfo">
                    <div style="color: #ffff64; margin-bottom: 5px;">GAME INFO</div>
                    <div id="gameDescription">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ D-Pad –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π.</div>
                </div>
                
                <div class="game-overlay" id="gameOverlay">
                    <div class="overlay-title" id="overlayTitle">GAME READY</div>
                    <div id="overlayText">Press START to begin</div>
                </div>
                
                <div class="loading-screen" id="loadingScreen">
                    <div style="font-size: 28px; margin-bottom: 10px;">‚ö° LOADING GAME ‚ö°</div>
                    <div style="font-size: 16px;" id="loadingText">Initializing...</div>
                    <div class="loading-bar">
                        <div class="loading-fill" id="loadingFill"></div>
                    </div>
                </div>
            </div>
            
            <div class="controls-bar">
                <div class="dpad">
                    <div></div>
                    <div class="dpad-btn" data-key="ArrowUp">‚ñ≤</div>
                    <div></div>
                    <div class="dpad-btn" data-key="ArrowLeft">‚óÑ</div>
                    <div class="dpad-btn" data-key="Space">‚óè</div>
                    <div class="dpad-btn" data-key="ArrowRight">‚ñ∫</div>
                    <div></div>
                    <div class="dpad-btn" data-key="ArrowDown">‚ñº</div>
                    <div></div>
                </div>
                
                <div class="action-buttons">
                    <div class="action-btn" data-key="KeyA">A</div>
                    <div class="action-btn" data-key="KeyB">B</div>
                    <div class="action-btn" data-key="KeyX">X</div>
                    <div class="action-btn" data-key="KeyY">Y</div>
                </div>
                
                <div class="system-controls">
                    <div class="system-btn" id="startBtn">START</div>
                    <div class="system-btn" id="pauseBtn">PAUSE</div>
                    <div class="system-btn" id="resetBtn">RESET</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ canvas
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        ctx.imageSmoothingEnabled = false;
        
        // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        class AdvancedSoundSystem {
            constructor() {
                this.audioContext = null;
                this.masterVolume = 0.3;
                this.sounds = {};
                this.initAudio();
            }
            
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
            
            createTone(frequency, duration, type = 'square', volume = 1, envelope = null) {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(frequency * 2, this.audioContext.currentTime);
                
                if (envelope) {
                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(this.masterVolume * volume, this.audioContext.currentTime + envelope.attack);
                    gainNode.gain.linearRampToValueAtTime(this.masterVolume * volume * envelope.sustain, this.audioContext.currentTime + envelope.attack + envelope.decay);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                } else {
                    gainNode.gain.setValueAtTime(this.masterVolume * volume, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                }
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playMove() { this.createTone(440, 0.1, 'square'); }
            playRotate() { this.createTone(660, 0.15, 'square'); }
            playDrop() { this.createTone(220, 0.2, 'triangle'); }
            playLineClear() { 
                const notes = [523, 659, 784, 1047];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.25, 'square'), i * 80);
                });
            }
            playTetris() {
                const melody = [523, 659, 784, 1047, 784, 659, 523, 440];
                melody.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.2, 'square'), i * 120);
                });
            }
            playGameOver() {
                const notes = [440, 415, 392, 370, 349, 330, 311, 294];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.4, 'sawtooth'), i * 200);
                });
            }
            playLevelUp() {
                const notes = [523, 659, 784, 1047, 1319];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createTone(freq, 0.25, 'triangle'), i * 100);
                });
            }
            playShoot() { this.createTone(800, 0.15, 'square'); }
            playExplosion() { this.createTone(150, 0.5, 'sawtooth'); }
            playJump() { this.createTone(880, 0.2, 'square'); }
            playPickup() { this.createTone(1200, 0.2, 'triangle'); }
        }
        
        const soundSystem = new AdvancedSoundSystem();
        
        // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä (30 —à—Ç—É–∫)
        const allGames = {
            puzzle: [
                { id: 'tetris', title: 'TETRIS\nPRO', icon: 'üß©', description: '–£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –¢–µ—Ç—Ä–∏—Å —Å –Ω–æ–≤—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏, –∫–æ–º–±–æ-—Å–∏—Å—Ç–µ–º–æ–π –∏ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π.' },
                { id: 'snake', title: 'SNAKE\nDELUXE', icon: 'üêç', description: '–ó–º–µ–π–∫–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–æ–π, –±–æ–Ω—É—Å–∞–º–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏.' },
                { id: 'breakout', title: 'BRICK\nBREAKER', icon: 'üß±', description: '–ê—Ä–∫–∞–Ω–æ–∏–¥ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º—è—á–∞–º–∏, –±–æ–Ω—É—Å–∞–º–∏ –∏ —Ä–∞–∑—Ä—É—à–∞–µ–º—ã–º–∏ –±–ª–æ–∫–∞–º–∏.' },
                { id: 'match3', title: 'JEWEL\nCRUSH', icon: 'üíé', description: '–¢—Ä–∏ –≤ —Ä—è–¥ —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º–∏ –∫–æ–º–±–æ –∏ –≤–∑—Ä—ã–≤–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏.' },
                { id: 'sokoban', title: 'BOX\nPUSHER', icon: 'üì¶', description: '–ì–æ–ª–æ–≤–æ–ª–æ–º–∫–∞ —Å —è—â–∏–∫–∞–º–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è–º–∏ –Ω–∞ 50 —É—Ä–æ–≤–Ω—è—Ö.' },
                { id: 'pipes', title: 'PIPE\nCONNECT', icon: 'üîß', description: '–°–æ–µ–¥–∏–Ω—è–π—Ç–µ —Ç—Ä—É–±—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –≤–æ–¥—ã.' },
                { id: 'sudoku', title: 'NUMBER\nGRID', icon: 'üî¢', description: '–°—É–¥–æ–∫—É —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –æ—à–∏–±–æ–∫.' },
                { id: 'minesweeper', title: 'MINE\nFIELD', icon: 'üí£', description: '–°–∞–ø—ë—Ä —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é –∏ —Ä–µ–∂–∏–º–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏.' }
            ],
            arcade: [
                { id: 'racing', title: 'SUPER\nRACER', icon: 'üèéÔ∏è', description: '–í—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω—ã–µ –≥–æ–Ω–∫–∏ —Å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è–º–∏ –∏ –±–æ–Ω—É—Å–∞–º–∏.' },
                { id: 'pacman', title: 'DOT\nEATER', icon: 'üëª', description: '–ü–∞–∫–º–∞–Ω —Å –Ω–æ–≤—ã–º–∏ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞–º–∏ –∏ —É—Å–∏–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–¥–µ–Ω–∏—è–º–∏.' },
                { id: 'frogger', title: 'ROAD\nHOPPER', icon: 'üê∏', description: '–ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –¥–æ—Ä–æ–≥–∏ –∏ —Ä–µ–∫–∏, –∏–∑–±–µ–≥–∞—è –æ–ø–∞—Å–Ω–æ—Å—Ç–µ–π.' },
                { id: 'centipede', title: 'BUG\nBLASTER', icon: 'üêõ', description: '–°—Ç—Ä–µ–ª—è–π—Ç–µ –ø–æ –Ω–∞—Å–µ–∫–æ–º—ã–º, —Å–ø—É—Å–∫–∞—é—â–∏–º—Å—è —Å–≤–µ—Ä—Ö—É.' },
                { id: 'qbert', title: 'CUBE\nHOPPER', icon: 'üé≤', description: '–ü—Ä—ã–≥–∞–π—Ç–µ –ø–æ –∫—É–±–∞–º, –º–µ–Ω—è—è –∏—Ö —Ü–≤–µ—Ç.' },
                { id: 'dkong', title: 'BARREL\nJUMP', icon: 'ü¶ç', description: '–ò–∑–±–µ–≥–∞–π—Ç–µ –±–æ—á–µ–∫ –∏ –ø–æ–¥–Ω–∏–º–∞–π—Ç–µ—Å—å –≤–≤–µ—Ä—Ö.' },
                { id: 'tron', title: 'LIGHT\nCYCLE', icon: 'üåê', description: '–ì–æ–Ω–∫–∏ –Ω–∞ —Å–≤–µ—Ç–æ–≤—ã—Ö –º–æ—Ç–æ—Ü–∏–∫–ª–∞—Ö —Å —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–ª–µ–¥–∞–º–∏.' }
            ],
            action: [
                { id: 'tanks', title: 'BATTLE\nCITY', icon: 'üöÄ', description: '–¢–∞–Ω–∫–æ–≤—ã–µ –±–æ–∏ —Å —Ä–∞–∑—Ä—É—à–∞–µ–º–æ–π —Å—Ä–µ–¥–æ–π –∏ –±–æ—Å—Å–∞–º–∏.' },
                { id: 'spaceshooter', title: 'GALAGA\nWARS', icon: 'üöÄ', description: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä —Å –≤–æ–ª–Ω–∞–º–∏ –≤—Ä–∞–≥–æ–≤ –∏ –∞–ø–≥—Ä–µ–π–¥–∞–º–∏.' },
                { id: 'asteroids', title: 'METEOR\nSTORM', icon: 'üåå', description: '–£–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ –∞—Å—Ç–µ—Ä–æ–∏–¥—ã –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –∫–æ—Å–º–æ—Å–µ.' },
                { id: 'platformer', title: 'PIXEL\nHERO', icon: 'ü¶ò', description: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–µ—Ä —Å –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏.' },
                { id: 'defender', title: 'PLANET\nGUARD', icon: 'üõ∏', description: '–ó–∞—â–∏—â–∞–π—Ç–µ –ø–ª–∞–Ω–µ—Ç—É –æ—Ç –≤—Ç–æ—Ä–∂–µ–Ω–∏—è –ø—Ä–∏—à–µ–ª—å—Ü–µ–≤.' },
                { id: 'contra', title: 'JUNGLE\nWAR', icon: 'üî´', description: '–ë–µ–≥ –∏ —Å—Ç—Ä–µ–ª—å–±–∞ –≤ –¥–∂—É–Ω–≥–ª—è—Ö –ø—Ä–æ—Ç–∏–≤ –∞—Ä–º–∏–∏ –≤—Ä–∞–≥–æ–≤.' },
                { id: 'gradius', title: 'SPACE\nFORCE', icon: '‚úàÔ∏è', description: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —à—É—Ç–µ—Ä —Å —Å–∏—Å—Ç–µ–º–æ–π —É–ª—É—á—à–µ–Ω–∏–π.' }
            ],
            original: [
                { id: 'quantum', title: 'QUANTUM\nSHIFT', icon: '‚öõÔ∏è', description: '–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–≤–∞–Ω—Ç–æ–≤—ã–º–∏ —á–∞—Å—Ç–∏—Ü–∞–º–∏ –≤ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.' },
                { id: 'gravity', title: 'GRAVITY\nWELL', icon: 'üåÄ', description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –≥–æ–ª–æ–≤–æ–ª–æ–º–æ–∫.' },
                { id: 'timewarp', title: 'TIME\nWARP', icon: '‚è∞', description: '–ú–∞–Ω–∏–ø—É–ª–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º–µ–Ω–µ–º –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π.' },
                { id: 'neonrun', title: 'NEON\nRUNNER', icon: 'üåà', description: '–ë–µ–≥–∏—Ç–µ –ø–æ –Ω–µ–æ–Ω–æ–≤—ã–º –¥–æ—Ä–æ–∂–∫–∞–º –ø–æ–¥ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –º—É–∑—ã–∫—É.' },
                { id: 'synthwave', title: 'SYNTH\nWAVE', icon: 'üéµ', description: '–†–∏—Ç–º-–∏–≥—Ä–∞ –≤ —Å—Ç–∏–ª–µ 80—Ö —Å —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä–Ω—ã–º–∏ –º–µ–ª–æ–¥–∏—è–º–∏.' },
                { id: 'pixelart', title: 'PIXEL\nPAINT', icon: 'üé®', description: '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–∏–∫—Å–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ –ø–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏.' },
                { id: 'codebreak', title: 'CODE\nBREAK', icon: 'üíª', description: '–í–∑–ª–∞–º—ã–≤–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—ã, —Ä–µ—à–∞—è –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∏.' },
                { id: 'dreamscape', title: 'DREAM\nSCAPE', icon: 'üí≠', description: '–ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π—Ç–µ –ø–æ —Å—é—Ä—Ä–µ–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–º –º–∏—Ä–∞–º —Å–Ω–æ–≤.' }
            ]
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentGame = null;
        let activeGameInstance = null;
        let gameRunning = false;
        let keys = {};
        
        // –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä
        class BaseGame {
            constructor() {
                this.score = 0;
                this.level = 1;
                this.lives = 3;
                this.running = false;
                this.paused = false;
            }
            
            init() {
                this.score = 0;
                this.level = 1;
                this.lives = 3;
                this.updateHUD();
                this.setupGame();
            }
            
            setupGame() {}
            
            start() {
                this.running = true;
                this.paused = false;
                this.gameLoop();
            }
            
            stop() {
                this.running = false;
            }
            
            pause() {
                this.paused = !this.paused;
            }
            
            gameLoop() {
                if (!this.running) return;
                
                if (!this.paused) {
                    this.update();
                    this.draw();
                }
                
                requestAnimationFrame(() => this.gameLoop());
            }
            
            update() {}
            draw() {}
            
            updateHUD() {
                document.getElementById('score').textContent = this.score.toString().padStart(6, '0');
                document.getElementById('level').textContent = this.level.toString().padStart(2, '0');
                document.getElementById('lives').textContent = this.lives;
            }
            
            gameOver() {
                this.running = false;
                soundSystem.playGameOver();
                showOverlay('GAME OVER', `FINAL SCORE: ${this.score}`);
            }
        }
        
        // –£–ª—É—á—à–µ–Ω–Ω—ã–π –¢–µ—Ç—Ä–∏—Å
        class EnhancedTetrisGame extends BaseGame {
            constructor() {
                super();
                this.BOARD_WIDTH = 10;
                this.BOARD_HEIGHT = 20;
                this.CELL_SIZE = 30;
                this.board = [];
                this.currentPiece = null;
                this.nextPiece = null;
                this.heldPiece = null;
                this.canHold = true;
                this.fallTime = 0;
                this.fallSpeed = 800;
                this.lines = 0;
                this.combo = 0;
                this.particles = [];
                this.ghostPiece = null;
                
                this.tetrominoes = {
                    I: { shape: [[1,1,1,1]], color: '#00FFFF', glow: '#00FFFF' },
                    O: { shape: [[1,1],[1,1]], color: '#FFFF00', glow: '#FFFF00' },
                    T: { shape: [[0,1,0],[1,1,1]], color: '#AA00FF', glow: '#AA00FF' },
                    S: { shape: [[0,1,1],[1,1,0]], color: '#00FF00', glow: '#00FF00' },
                    Z: { shape: [[1,1,0],[0,1,1]], color: '#FF0000', glow: '#FF0000' },
                    J: { shape: [[1,0,0],[1,1,1]], color: '#0000FF', glow: '#0000FF' },
                    L: { shape: [[0,0,1],[1,1,1]], color: '#FF7F00', glow: '#FF7F00' }
                };
            }
            
            setupGame() {
                this.board = Array(this.BOARD_HEIGHT).fill(null).map(() => Array(this.BOARD_WIDTH).fill(null));
                this.spawnPiece();
                this.spawnNextPiece();
                this.fallTime = 0;
                this.lines = 0;
                this.combo = 0;
                this.particles = [];
            }
            
            spawnPiece() {
                if (this.nextPiece) {
                    this.currentPiece = this.nextPiece;
                    this.spawnNextPiece();
                } else {
                    this.currentPiece = this.createRandomPiece();
                }
                
                this.currentPiece.x = Math.floor(this.BOARD_WIDTH / 2) - Math.floor(this.currentPiece.shape[0].length / 2);
                this.currentPiece.y = 0;
                
                this.updateGhostPiece();
                
                if (this.checkCollision()) {
                    this.gameOver();
                }
            }
            
            spawnNextPiece() {
                this.nextPiece = this.createRandomPiece();
            }
            
            createRandomPiece() {
                const pieces = Object.keys(this.tetrominoes);
                const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
                const tetromino = this.tetrominoes[randomPiece];
                
                return {
                    shape: JSON.parse(JSON.stringify(tetromino.shape)),
                    color: tetromino.color,
                    glow: tetromino.glow,
                    type: randomPiece,
                    x: 0,
                    y: 0
                };
            }
            
            updateGhostPiece() {
                if (!this.currentPiece) return;
                
                this.ghostPiece = {
                    shape: this.currentPiece.shape,
                    x: this.currentPiece.x,
                    y: this.currentPiece.y,
                    color: this.currentPiece.color
                };
                
                while (!this.checkCollision(this.ghostPiece, 0, 1)) {
                    this.ghostPiece.y++;
                }
            }
            
            checkCollision(piece = this.currentPiece, offsetX = 0, offsetY = 0) {
                for (let y = 0; y < piece.shape.length; y++) {
                    for (let x = 0; x < piece.shape[y].length; x++) {
                        if (piece.shape[y][x]) {
                            const newX = piece.x + x + offsetX;
                            const newY = piece.y + y + offsetY;
                            
                            if (newX < 0 || newX >= this.BOARD_WIDTH || 
                                newY >= this.BOARD_HEIGHT ||
                                (newY >= 0 && this.board[newY][newX])) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }
            
            rotatePiece() {
                const rotated = this.currentPiece.shape[0].map((_, i) => 
                    this.currentPiece.shape.map(row => row[i]).reverse()
                );
                
                const originalShape = this.currentPiece.shape;
                this.currentPiece.shape = rotated;
                
                if (!this.checkCollision()) {
                    soundSystem.playRotate();
                    this.updateGhostPiece();
                    this.createRotateParticles();
                } else {
                    // Wall kicks
                    const wallKicks = [[1, 0], [-1, 0], [0, -1], [2, 0], [-2, 0]];
                    let kicked = false;
                    
                    for (let [dx, dy] of wallKicks) {
                        if (!this.checkCollision(this.currentPiece, dx, dy)) {
                            this.currentPiece.x += dx;
                            this.currentPiece.y += dy;
                            kicked = true;
                            soundSystem.playRotate();
                            this.updateGhostPiece();
                            this.createRotateParticles();
                            break;
                        }
                    }
                    
                    if (!kicked) {
                        this.currentPiece.shape = originalShape;
                    }
                }
            }
            
            movePiece(dx, dy) {
                if (!this.checkCollision(this.currentPiece, dx, dy)) {
                    this.currentPiece.x += dx;
                    this.currentPiece.y += dy;
                    if (dx !== 0) {
                        soundSystem.playMove();
                        this.updateGhostPiece();
                    }
                    return true;
                }
                return false;
            }
            
            hardDrop() {
                let dropDistance = 0;
                while (this.movePiece(0, 1)) {
                    dropDistance++;
                }
                this.score += dropDistance * 2;
                soundSystem.playDrop();
                this.lockPiece();
            }
            
            lockPiece() {
                for (let y = 0; y < this.currentPiece.shape.length; y++) {
                    for (let x = 0; x < this.currentPiece.shape[y].length; x++) {
                        if (this.currentPiece.shape[y][x]) {
                            const boardY = this.currentPiece.y + y;
                            const boardX = this.currentPiece.x + x;
                            if (boardY >= 0) {
                                this.board[boardY][boardX] = {
                                    color: this.currentPiece.color,
                                    glow: this.currentPiece.glow
                                };
                            }
                        }
                    }
                }
                
                this.clearLines();
                this.spawnPiece();
                this.canHold = true;
            }
            
            clearLines() {
                let linesCleared = 0;
                let clearedRows = [];
                
                for (let y = this.BOARD_HEIGHT - 1; y >= 0; y--) {
                    if (this.board[y].every(cell => cell !== null)) {
                        clearedRows.push(y);
                        this.board.splice(y, 1);
                        this.board.unshift(Array(this.BOARD_WIDTH).fill(null));
                        linesCleared++;
                        y++; // Check the same line again
                    }
                }
                
                if (linesCleared > 0) {
                    this.lines += linesCleared;
                    this.combo++;
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—ã—Ö –ª–∏–Ω–∏–π
                    clearedRows.forEach(row => this.createLineClearEffect(row));
                    
                    // –°—á–µ—Ç
                    const baseScore = [0, 40, 100, 300, 1200][linesCleared];
                    const comboBonus = this.combo > 1 ? this.combo * 50 : 0;
                    this.score += (baseScore + comboBonus) * (this.level + 1);
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–±–æ
                    if (this.combo > 1) {
                        this.showComboEffect(this.combo);
                    }
                    
                    // –£—Ä–æ–≤–µ–Ω—å
                    const newLevel = Math.floor(this.lines / 10) + 1;
                    if (newLevel > this.level) {
                        this.level = newLevel;
                        this.fallSpeed = Math.max(50, 800 - (this.level - 1) * 50);
                        soundSystem.playLevelUp();
                    }
                    
                    // –ó–≤—É–∫–∏
                    if (linesCleared === 4) {
                        soundSystem.playTetris();
                    } else {
                        soundSystem.playLineClear();
                    }
                } else {
                    this.combo = 0;
                }
                
                this.updateHUD();
            }
            
            createLineClearEffect(row) {
                for (let x = 0; x < this.BOARD_WIDTH; x++) {
                    for (let i = 0; i < 5; i++) {
                        this.particles.push({
                            x: (canvas.width - this.BOARD_WIDTH * this.CELL_SIZE) / 2 + x * this.CELL_SIZE + this.CELL_SIZE / 2,
                            y: (canvas.height - this.BOARD_HEIGHT * this.CELL_SIZE) / 2 + row * this.CELL_SIZE + this.CELL_SIZE / 2,
                            vx: (Math.random() - 0.5) * 8,
                            vy: (Math.random() - 0.5) * 8 - 3,
                            life: 60,
                            maxLife: 60,
                            color: '#FFFFFF',
                            size: Math.random() * 3 + 1
                        });
                    }
                }
            }
            
            createRotateParticles() {
                const centerX = (canvas.width - this.BOARD_WIDTH * this.CELL_SIZE) / 2 + 
                              this.currentPiece.x * this.CELL_SIZE + this.CELL_SIZE;
                const centerY = (canvas.height - this.BOARD_HEIGHT * this.CELL_SIZE) / 2 + 
                              this.currentPiece.y * this.CELL_SIZE + this.CELL_SIZE;
                
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    this.particles.push({
                        x: centerX,
                        y: centerY,
                        vx: Math.cos(angle) * 3,
                        vy: Math.sin(angle) * 3,
                        life: 30,
                        maxLife: 30,
                        color: this.currentPiece.glow,
                        size: 2
                    });
                }
            }
            
            showComboEffect(combo) {
                const comboElement = document.createElement('div');
                comboElement.className = 'combo-effect';
                comboElement.textContent = `COMBO x${combo}`;
                comboElement.style.left = '50%';
                comboElement.style.top = '30%';
                comboElement.style.transform = 'translateX(-50%)';
                
                document.body.appendChild(comboElement);
                
                setTimeout(() => {
                    if (document.body.contains(comboElement)) {
                        document.body.removeChild(comboElement);
                    }
                }, 1000);
            }
            
            holdPiece() {
                if (!this.canHold) return;
                
                if (this.heldPiece === null) {
                    this.heldPiece = this.currentPiece.type;
                    this.spawnPiece();
                } else {
                    const temp = this.heldPiece;
                    this.heldPiece = this.currentPiece.type;
                    this.currentPiece = this.createPieceByType(temp);
                    this.currentPiece.x = Math.floor(this.BOARD_WIDTH / 2) - Math.floor(this.currentPiece.shape[0].length / 2);
                    this.currentPiece.y = 0;
                    this.updateGhostPiece();
                }
                
                this.canHold = false;
                soundSystem.playMove();
            }
            
            createPieceByType(type) {
                const tetromino = this.tetrominoes[type];
                return {
                    shape: JSON.parse(JSON.stringify(tetromino.shape)),
                    color: tetromino.color,
                    glow: tetromino.glow,
                    type: type,
                    x: 0,
                    y: 0
                };
            }
            
            update() {
                this.fallTime += 16;
                
                if (this.fallTime >= this.fallSpeed) {
                    if (!this.movePiece(0, 1)) {
                        this.lockPiece();
                    }
                    this.fallTime = 0;
                }
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                if (keys['ArrowLeft']) {
                    this.movePiece(-1, 0);
                    keys['ArrowLeft'] = false;
                }
                if (keys['ArrowRight']) {
                    this.movePiece(1, 0);
                    keys['ArrowRight'] = false;
                }
                if (keys['ArrowDown']) {
                    if (this.movePiece(0, 1)) {
                        this.score += 1;
                    }
                }
                if (keys['Space']) {
                    this.hardDrop();
                    keys['Space'] = false;
                }
                if (keys['KeyA']) {
                    this.rotatePiece();
                    keys['KeyA'] = false;
                }
                if (keys['KeyB']) {
                    this.holdPiece();
                    keys['KeyB'] = false;
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.3; // –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è
                    particle.life--;
                    return particle.life > 0;
                });
                
                this.updateHUD();
            }
            
            draw() {
                // –û—á–∏—Å—Ç–∫–∞
                ctx.fillStyle = '#000011';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –§–æ–Ω –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
                const offsetX = (canvas.width - this.BOARD_WIDTH * this.CELL_SIZE) / 2;
                const offsetY = (canvas.height - this.BOARD_HEIGHT * this.CELL_SIZE) / 2;
                
                ctx.save();
                ctx.translate(offsetX, offsetY);
                
                // –†–∞–º–∫–∞ –ø–æ–ª—è
                ctx.strokeStyle = '#00FFFF';
                ctx.lineWidth = 3;
                ctx.strokeRect(-3, -3, this.BOARD_WIDTH * this.CELL_SIZE + 6, this.BOARD_HEIGHT * this.CELL_SIZE + 6);
                
                // –°–µ—Ç–∫–∞
                ctx.strokeStyle = '#333366';
                ctx.lineWidth = 1;
                for (let x = 0; x <= this.BOARD_WIDTH; x++) {
                    ctx.beginPath();
                    ctx.moveTo(x * this.CELL_SIZE, 0);
                    ctx.lineTo(x * this.CELL_SIZE, this.BOARD_HEIGHT * this.CELL_SIZE);
                    ctx.stroke();
                }
                for (let y = 0; y <= this.BOARD_HEIGHT; y++) {
                    ctx.beginPath();
                    ctx.moveTo(0, y * this.CELL_SIZE);
                    ctx.lineTo(this.BOARD_WIDTH * this.CELL_SIZE, y * this.CELL_SIZE);
                    ctx.stroke();
                }
                
                // –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏
                for (let y = 0; y < this.BOARD_HEIGHT; y++) {
                    for (let x = 0; x < this.BOARD_WIDTH; x++) {
                        if (this.board[y][x]) {
                            this.drawEnhancedBlock(x, y, this.board[y][x].color, this.board[y][x].glow);
                        }
                    }
                }
                
                // –ü—Ä–∏–∑—Ä–∞–∫ —Ç–µ–∫—É—â–µ–≥–æ –∫—É—Å–∫–∞
                if (this.ghostPiece) {
                    ctx.save();
                    ctx.globalAlpha = 0.3;
                    for (let y = 0; y < this.ghostPiece.shape.length; y++) {
                        for (let x = 0; x < this.ghostPiece.shape[y].length; x++) {
                            if (this.ghostPiece.shape[y][x]) {
                                this.drawEnhancedBlock(this.ghostPiece.x + x, this.ghostPiece.y + y, this.ghostPiece.color, this.ghostPiece.color);
                            }
                        }
                    }
                    ctx.restore();
                }
                
                // –¢–µ–∫—É—â–∏–π –∫—É—Å–æ–∫
                if (this.currentPiece) {
                    for (let y = 0; y < this.currentPiece.shape.length; y++) {
                        for (let x = 0; x < this.currentPiece.shape[y].length; x++) {
                            if (this.currentPiece.shape[y][x]) {
                                this.drawEnhancedBlock(this.currentPiece.x + x, this.currentPiece.y + y, this.currentPiece.color, this.currentPiece.glow);
                            }
                        }
                    }
                }
                
                ctx.restore();
                
                // –°–ª–µ–¥—É—é—â–∏–π –∫—É—Å–æ–∫
                if (this.nextPiece) {
                    this.drawNextPiece();
                }
                
                // –£–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –∫—É—Å–æ–∫
                if (this.heldPiece) {
                    this.drawHeldPiece();
                }
                
                // –ß–∞—Å—Ç–∏—Ü—ã
                this.particles.forEach(particle => {
                    ctx.save();
                    ctx.globalAlpha = particle.life / particle.maxLife;
                    ctx.fillStyle = particle.color;
                    ctx.shadowColor = particle.color;
                    ctx.shadowBlur = 5;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
            }
            
            drawEnhancedBlock(x, y, color, glowColor) {
                const blockX = x * this.CELL_SIZE;
                const blockY = y * this.CELL_SIZE;
                
                ctx.save();
                
                // –û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫
                ctx.fillStyle = color;
                ctx.shadowColor = glowColor;
                ctx.shadowBlur = 10;
                ctx.fillRect(blockX + 1, blockY + 1, this.CELL_SIZE - 2, this.CELL_SIZE - 2);
                
                // –ë–ª–∏–∫
                const gradient = ctx.createLinearGradient(blockX, blockY, blockX + this.CELL_SIZE, blockY + this.CELL_SIZE);
                gradient.addColorStop(0, 'rgba(255,255,255,0.6)');
                gradient.addColorStop(1, 'rgba(255,255,255,0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(blockX + 2, blockY + 2, this.CELL_SIZE - 4, this.CELL_SIZE - 4);
                
                // –†–∞–º–∫–∞
                ctx.strokeStyle = '#FFFFFF';
                ctx.lineWidth = 1;
                ctx.strokeRect(blockX + 1, blockY + 1, this.CELL_SIZE - 2, this.CELL_SIZE - 2);
                
                ctx.restore();
            }
            
            drawNextPiece() {
                if (!this.nextPiece) return;
                
                const previewX = canvas.width - 120;
                const previewY = 50;
                
                ctx.save();
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(previewX - 10, previewY - 10, 100, 80);
                
                ctx.strokeStyle = '#00FFFF';
                ctx.lineWidth = 2;
                ctx.strokeRect(previewX - 10, previewY - 10, 100, 80);
                
                ctx.fillStyle = '#00FFFF';
                ctx.font = '12px Press Start 2P';
                ctx.fillText('NEXT', previewX, previewY - 20);
                
                const piece = this.nextPiece;
                const startX = previewX + (80 - piece.shape[0].length * 15) / 2;
                const startY = previewY + (60 - piece.shape.length * 15) / 2;
                
                for (let y = 0; y < piece.shape.length; y++) {
                    for (let x = 0; x < piece.shape[y].length; x++) {
                        if (piece.shape[y][x]) {
                            ctx.fillStyle = piece.color;
                            ctx.shadowColor = piece.glow;
                            ctx.shadowBlur = 5;
                            ctx.fillRect(startX + x * 15, startY + y * 15, 13, 13);
                        }
                    }
                }
                
                ctx.restore();
            }
            
            drawHeldPiece() {
                const previewX = canvas.width - 120;
                const previewY = 150;
                
                ctx.save();
                ctx.fillStyle = 'rgba(0,0,0,0.8)';
                ctx.fillRect(previewX - 10, previewY - 10, 100, 80);
                
                ctx.strokeStyle = '#FFFF00';
                ctx.lineWidth = 2;
                ctx.strokeRect(previewX - 10, previewY - 10, 100, 80);
                
                ctx.fillStyle = '#FFFF00';
                ctx.font = '12px Press Start 2P';
                ctx.fillText('HOLD', previewX, previewY - 20);
                
                const piece = this.createPieceByType(this.heldPiece);
                const startX = previewX + (80 - piece.shape[0].length * 15) / 2;
                const startY = previewY + (60 - piece.shape.length * 15) / 2;
                
                ctx.globalAlpha = this.canHold ? 1 : 0.5;
                
                for (let y = 0; y < piece.shape.length; y++) {
                    for (let x = 0; x < piece.shape[y].length; x++) {
                        if (piece.shape[y][x]) {
                            ctx.fillStyle = piece.color;
                            ctx.shadowColor = piece.glow;
                            ctx.shadowBlur = 5;
                            ctx.fillRect(startX + x * 15, startY + y * 15, 13, 13);
                        }
                    }
                }
                
                ctx.restore();
            }
        }
        
        // Quantum Shift - –ê–≤—Ç–æ—Ä—Å–∫–∞—è –∏–≥—Ä–∞
        class QuantumShiftGame extends BaseGame {
            constructor() {
                super();
                this.particles = [];
                this.dimensions = 3;
                this.currentDimension = 0;
                this.quantumField = [];
                this.player = { x: 5, y: 5, phase: 0 };
                this.targets = [];
                this.obstacles = [];
                this.phaseTimer = 0;
            }
            
            setupGame() {
                this.quantumField = Array(3).fill(null).map(() => 
                    Array(15).fill(null).map(() => Array(20).fill(0))
                );
                
                this.player = { x: 5, y: 5, phase: 0 };
                this.targets = [];
                this.obstacles = [];
                this.phaseTimer = 0;
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
                for (let d = 0; d < 3; d++) {
                    for (let i = 0; i < 5; i++) {
                        this.targets.push({
                            x: Math.floor(Math.random() * 20),
                            y: Math.floor(Math.random() * 15),
                            dimension: d,
                            collected: false
                        });
                    }
                    
                    for (let i = 0; i < 8; i++) {
                        this.obstacles.push({
                            x: Math.floor(Math.random() * 20),
                            y: Math.floor(Math.random() * 15),
                            dimension: d,
                            active: true
                        });
                    }
                }
            }
            
            update() {
                this.phaseTimer += 16;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏–π
                if (this.phaseTimer > 3000) {
                    this.currentDimension = (this.currentDimension + 1) % 3;
                    this.phaseTimer = 0;
                    this.createQuantumEffect();
                }
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                if (keys['ArrowLeft'] && this.player.x > 0) {
                    this.player.x--;
                    keys['ArrowLeft'] = false;
                }
                if (keys['ArrowRight'] && this.player.x < 19) {
                    this.player.x++;
                    keys['ArrowRight'] = false;
                }
                if (keys['ArrowUp'] && this.player.y > 0) {
                    this.player.y--;
                    keys['ArrowUp'] = false;
                }
                if (keys['ArrowDown'] && this.player.y < 14) {
                    this.player.y++;
                    keys['ArrowDown'] = false;
                }
                if (keys['Space']) {
                    this.currentDimension = (this.currentDimension + 1) % 3;
                    this.createQuantumEffect();
                    keys['Space'] = false;
                }
                
                // –°–±–æ—Ä —Ü–µ–ª–µ–π
                this.targets.forEach(target => {
                    if (!target.collected && 
                        target.x === this.player.x && 
                        target.y === this.player.y && 
                        target.dimension === this.currentDimension) {
                        target.collected = true;
                        this.score += 100;
                        soundSystem.playPickup();
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                this.obstacles.forEach(obstacle => {
                    if (obstacle.active &&
                        obstacle.x === this.player.x && 
                        obstacle.y === this.player.y && 
                        obstacle.dimension === this.currentDimension) {
                        this.lives--;
                        obstacle.active = false;
                        this.createExplosionEffect(this.player.x, this.player.y);
                        soundSystem.playExplosion();
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã
                if (this.targets.every(target => target.collected)) {
                    this.level++;
                    this.setupGame();
                    soundSystem.playLevelUp();
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    return particle.life > 0;
                });
                
                this.updateHUD();
            }
            
            createQuantumEffect() {
                for (let i = 0; i < 20; i++) {
                    this.particles.push({
                        x: this.player.x * 30 + 15,
                        y: this.player.y * 30 + 15,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 30,
                        color: ['#FF00FF', '#00FFFF', '#FFFF00'][this.currentDimension]
                    });
                }
            }
            
            createExplosionEffect(x, y) {
                for (let i = 0; i < 15; i++) {
                    this.particles.push({
                        x: x * 30 + 15,
                        y: y * 30 + 15,
                        vx: (Math.random() - 0.5) * 8,
                        vy: (Math.random() - 0.5) * 8,
                        life: 40,
                        color: '#FF0000'
                    });
                }
            }
            
            draw() {
                // –§–æ–Ω
                const colors = ['#001122', '#220011', '#112200'];
                ctx.fillStyle = colors[this.currentDimension];
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // –°–µ—Ç–∫–∞
                ctx.strokeStyle = ['#0066FF', '#FF0066', '#66FF00'][this.currentDimension];
                ctx.lineWidth = 1;
                for (let x = 0; x <= 20; x++) {
                    ctx.beginPath();
                    ctx.moveTo(x * 30, 0);
                    ctx.lineTo(x * 30, 450);
                    ctx.stroke();
                }
                for (let y = 0; y <= 15; y++) {
                    ctx.beginPath();
                    ctx.moveTo(0, y * 30);
                    ctx.lineTo(600, y * 30);
                    ctx.stroke();
                }
                
                // –¶–µ–ª–∏
                this.targets.forEach(target => {
                    if (!target.collected && target.dimension === this.currentDimension) {
                        ctx.fillStyle = '#FFFF00';
                        ctx.shadowColor = '#FFFF00';
                        ctx.shadowBlur = 10;
                        ctx.beginPath();
                        ctx.arc(target.x * 30 + 15, target.y * 30 + 15, 8, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });
                
                // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                this.obstacles.forEach(obstacle => {
                    if (obstacle.active && obstacle.dimension === this.currentDimension) {
                        ctx.fillStyle = '#FF0000';
                        ctx.shadowColor = '#FF0000';
                        ctx.shadowBlur = 8;
                        ctx.fillRect(obstacle.x * 30 + 5, obstacle.y * 30 + 5, 20, 20);
                    }
                });
                
                // –ò–≥—Ä–æ–∫
                const playerColors = ['#00FFFF', '#FF00FF', '#FFFF00'];
                ctx.fillStyle = playerColors[this.currentDimension];
                ctx.shadowColor = playerColors[this.currentDimension];
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(this.player.x * 30 + 15, this.player.y * 30 + 15, 12, 0, Math.PI * 2);
                ctx.fill();
                
                // –ß–∞—Å—Ç–∏—Ü—ã
                this.particles.forEach(particle => {
                    ctx.save();
                    ctx.globalAlpha = particle.life / 30;
                    ctx.fillStyle = particle.color;
                    ctx.shadowColor = particle.color;
                    ctx.shadowBlur = 5;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∏–∑–º–µ—Ä–µ–Ω–∏—è
                ctx.fillStyle = '#FFFFFF';
                ctx.font = '16px Press Start 2P';
                ctx.fillText(`DIMENSION: ${this.currentDimension + 1}`, 10, 500);
                
                // –¢–∞–π–º–µ—Ä —Ñ–∞–∑—ã
                const phaseProgress = this.phaseTimer / 3000;
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillRect(10, 520, 200, 10);
                ctx.fillStyle = playerColors[this.currentDimension];
                ctx.fillRect(10, 520, 200 * phaseProgress, 10);
            }
        }
        
        // Neon Runner - –ê–≤—Ç–æ—Ä—Å–∫–∞—è –∏–≥—Ä–∞
        class NeonRunnerGame extends BaseGame {
            constructor() {
                super();
                this.player = { x: 3, y: 8, trail: [] };
                this.obstacles = [];
                this.powerups = [];
                this.neonTrails = [];
                this.speed = 2;
                this.distance = 0;
                this.lanes = 7;
                this.spawnTimer = 0;
            }
            
            setupGame() {
                this.player = { x: 3, y: 8, trail: [] };
                this.obstacles = [];
                this.powerups = [];
                this.neonTrails = [];
                this.speed = 2 + this.level * 0.5;
                this.distance = 0;
                this.spawnTimer = 0;
            }
            
            update() {
                this.distance += this.speed;
                this.spawnTimer++;
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                if (keys['ArrowLeft'] && this.player.x > 0) {
                    this.player.x--;
                    keys['ArrowLeft'] = false;
                }
                if (keys['ArrowRight'] && this.player.x < this.lanes - 1) {
                    this.player.x++;
                    keys['ArrowRight'] = false;
                }
                
                // –°–ø–∞–≤–Ω –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                if (this.spawnTimer > Math.max(20, 60 - this.level * 5)) {
                    if (Math.random() < 0.7) {
                        this.obstacles.push({
                            x: Math.floor(Math.random() * this.lanes),
                            y: -2,
                            type: Math.random() < 0.5 ? 'wall' : 'laser'
                        });
                    }
                    
                    if (Math.random() < 0.3) {
                        this.powerups.push({
                            x: Math.floor(Math.random() * this.lanes),
                            y: -2,
                            type: Math.random() < 0.5 ? 'speed' : 'score'
                        });
                    }
                    
                    this.spawnTimer = 0;
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
                this.obstacles.forEach((obstacle, index) => {
                    obstacle.y += this.speed * 0.5;
                    
                    // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
                    if (Math.abs(obstacle.x - this.player.x) < 0.8 && 
                        Math.abs(obstacle.y - this.player.y) < 0.8) {
                        this.lives--;
                        this.obstacles.splice(index, 1);
                        this.createExplosion(this.player.x, this.player.y);
                        soundSystem.playExplosion();
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                    
                    if (obstacle.y > 15) {
                        this.obstacles.splice(index, 1);
                        this.score += 10;
                    }
                });
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
                this.powerups.forEach((powerup, index) => {
                    powerup.y += this.speed * 0.5;
                    
                    if (Math.abs(powerup.x - this.player.x) < 0.8 && 
                        Math.abs(powerup.y - this.player.y) < 0.8) {
                        this.powerups.splice(index, 1);
                        
                        if (powerup.type === 'speed') {
                            this.speed += 0.5;
                        } else {
                            this.score += 100;
                        }
                        
                        soundSystem.playPickup();
                    }
                    
                    if (powerup.y > 15) {
                        this.powerups.splice(index, 1);
                    }
                });
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥–∞
                this.player.trail.unshift({ x: this.player.x, y: this.player.y, life: 20 });
                if (this.player.trail.length > 20) {
                    this.player.trail.pop();
                }
                this.player.trail.forEach(segment => segment.life--);
                
                // –ù–µ–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                if (Math.random() < 0.1) {
                    this.neonTrails.push({
                        x: Math.random() * this.lanes,
                        y: -1,
                        color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                        life: 60
                    });
                }
                
                this.neonTrails = this.neonTrails.filter(trail => {
                    trail.y += this.speed * 0.3;
                    trail.life--;
                    return trail.life > 0 && trail.y < 16;
                });
                
                this.score += Math.floor(this.speed);
                
                // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                if (this.distance > this.level * 2000) {
                    this.level++;
                    soundSystem.playLevelUp();
                }
                
                this.updateHUD();
            }
            
            createExplosion(x, y) {
                for (let i = 0; i < 12; i++) {
                    this.neonTrails.push({
                        x: x + (Math.random() - 0.5) * 2,
                        y: y + (Math.random() - 0.5) * 2,
                        color: '#FF0000',
                        life: 30,
                        vx: (Math.random() - 0.5) * 4,
                        vy: (Math.random() - 0.5) * 4
                    });
                }
            }
            
            draw() {
                // –ß–µ—Ä–Ω—ã–π —Ñ–æ–Ω
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const laneWidth = canvas.width / this.lanes;
                const cellHeight = canvas.height / 12;
                
                // –ù–µ–æ–Ω–æ–≤—ã–µ –ª–∏–Ω–∏–∏ –¥–æ—Ä–æ–∂–∫–∏
                for (let i = 0; i <= this.lanes; i++) {
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, '#00FFFF');
                    gradient.addColorStop(1, '#0066FF');
                    
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = 3;
                    ctx.shadowColor = '#00FFFF';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.moveTo(i * laneWidth, 0);
                    ctx.lineTo(i * laneWidth, canvas.height);
                    ctx.stroke();
                }
                
                // –ù–µ–æ–Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                this.neonTrails.forEach(trail => {
                    ctx.save();
                    ctx.globalAlpha = trail.life / 60;
                    ctx.fillStyle = trail.color;
                    ctx.shadowColor = trail.color;
                    ctx.shadowBlur = 15;
                    
                    if (trail.vx !== undefined) {
                        trail.x += trail.vx * 0.1;
                        trail.y += trail.vy * 0.1;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(trail.x * laneWidth + laneWidth / 2, trail.y * cellHeight, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
                
                // –°–ª–µ–¥ –∏–≥—Ä–æ–∫–∞
                this.player.trail.forEach((segment, index) => {
                    if (segment.life > 0) {
                        ctx.save();
                        ctx.globalAlpha = segment.life / 20;
                        ctx.fillStyle = '#00FF00';
                        ctx.shadowColor = '#00FF00';
                        ctx.shadowBlur = 8;
                        ctx.beginPath();
                        ctx.arc(segment.x * laneWidth + laneWidth / 2, segment.y * cellHeight, 8 - index * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    }
                });
                
                // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
                this.obstacles.forEach(obstacle => {
                    ctx.save();
                    if (obstacle.type === 'wall') {
                        ctx.fillStyle = '#FF0000';
                        ctx.shadowColor = '#FF0000';
                        ctx.shadowBlur = 15;
                        ctx.fillRect(obstacle.x * laneWidth + 5, obstacle.y * cellHeight, laneWidth - 10, cellHeight - 5);
                    } else {
                        ctx.strokeStyle = '#FF0000';
                        ctx.lineWidth = 5;
                        ctx.shadowColor = '#FF0000';
                        ctx.shadowBlur = 20;
                        ctx.beginPath();
                        ctx.moveTo(obstacle.x * laneWidth, obstacle.y * cellHeight);
                        ctx.lineTo((obstacle.x + 1) * laneWidth, obstacle.y * cellHeight + cellHeight);
                        ctx.stroke();
                    }
                    ctx.restore();
                });
                
                // –ë–æ–Ω—É—Å—ã
                this.powerups.forEach(powerup => {
                    const color = powerup.type === 'speed' ? '#FFFF00' : '#FF00FF';
                    ctx.save();
                    ctx.fillStyle = color;
                    ctx.shadowColor = color;
                    ctx.shadowBlur = 12;
                    ctx.beginPath();
                    ctx.arc(powerup.x * laneWidth + laneWidth / 2, powerup.y * cellHeight, 10, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
                
                // –ò–≥—Ä–æ–∫
                ctx.save();
                ctx.fillStyle = '#00FF00';
                ctx.shadowColor = '#00FF00';
                ctx.shadowBlur = 20;
                ctx.beginPath();
                ctx.arc(this.player.x * laneWidth + laneWidth / 2, this.player.y * cellHeight, 15, 0, Math.PI * 2);
                ctx.fill();
                
                // –î–µ—Ç–∞–ª–∏ –∏–≥—Ä–æ–∫–∞
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.arc(this.player.x * laneWidth + laneWidth / 2 - 5, this.player.y * cellHeight - 3, 3, 0, Math.PI * 2);
                ctx.arc(this.player.x * laneWidth + laneWidth / 2 + 5, this.player.y * cellHeight - 3, 3, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
                
                // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∫–æ—Ä–æ—Å—Ç–∏
                ctx.fillStyle = '#00FFFF';
                ctx.font = '16px Press Start 2P';
                ctx.fillText(`SPEED: ${this.speed.toFixed(1)}`, 10, canvas.height - 20);
            }
        }
        
        // –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–≥—Ä
        const gameClasses = {
            // –ì–æ–ª–æ–≤–æ–ª–æ–º–∫–∏
            tetris: EnhancedTetrisGame,
            snake: class extends BaseGame {
                constructor() {
                    super();
                    this.snake = [{x: 10, y: 10}];
                    this.food = {x: 15, y: 15};
                    this.direction = {x: 1, y: 0};
                    this.gridSize = 20;
                    this.moveTimer = 0;
                }
                
                setupGame() {
                    this.snake = [{x: 10, y: 10}];
                    this.generateFood();
                    this.direction = {x: 1, y: 0};
                    this.moveTimer = 0;
                }
                
                generateFood() {
                    do {
                        this.food = {
                            x: Math.floor(Math.random() * 30),
                            y: Math.floor(Math.random() * 25)
                        };
                    } while (this.snake.some(segment => segment.x === this.food.x && segment.y === this.food.y));
                }
                
                update() {
                    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                    if (keys['ArrowLeft'] && this.direction.x === 0) {
                        this.direction = {x: -1, y: 0};
                    }
                    if (keys['ArrowRight'] && this.direction.x === 0) {
                        this.direction = {x: 1, y: 0};
                    }
                    if (keys['ArrowUp'] && this.direction.y === 0) {
                        this.direction = {x: 0, y: -1};
                    }
                    if (keys['ArrowDown'] && this.direction.y === 0) {
                        this.direction = {x: 0, y: 1};
                    }
                    
                    this.moveTimer++;
                    if (this.moveTimer >= Math.max(8, 20 - this.level)) {
                        const head = {
                            x: this.snake[0].x + this.direction.x,
                            y: this.snake[0].y + this.direction.y
                        };
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
                        if (head.x < 0 || head.x >= 40 || head.y < 0 || head.y >= 30) {
                            this.gameOver();
                            return;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å —Å–æ–±–æ–π
                        if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                            this.gameOver();
                            return;
                        }
                        
                        this.snake.unshift(head);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ–¥—ã
                        if (head.x === this.food.x && head.y === this.food.y) {
                            this.score += 100;
                            this.generateFood();
                            soundSystem.playPickup();
                            
                            if (this.snake.length % 5 === 0) {
                                this.level++;
                                soundSystem.playLevelUp();
                            }
                        } else {
                            this.snake.pop();
                        }
                        
                        this.moveTimer = 0;
                    }
                    
                    this.updateHUD();
                }
                
                draw() {
                    // –§–æ–Ω
                    ctx.fillStyle = '#001100';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const cellSize = Math.min(canvas.width / 40, canvas.height / 30);
                    const offsetX = (canvas.width - 40 * cellSize) / 2;
                    const offsetY = (canvas.height - 30 * cellSize) / 2;
                    
                    // –°–µ—Ç–∫–∞
                    ctx.strokeStyle = '#004400';
                    ctx.lineWidth = 1;
                    for (let x = 0; x <= 40; x++) {
                        ctx.beginPath();
                        ctx.moveTo(offsetX + x * cellSize, offsetY);
                        ctx.lineTo(offsetX + x * cellSize, offsetY + 30 * cellSize);
                        ctx.stroke();
                    }
                    for (let y = 0; y <= 30; y++) {
                        ctx.beginPath();
                        ctx.moveTo(offsetX, offsetY + y * cellSize);
                        ctx.lineTo(offsetX + 40 * cellSize, offsetY + y * cellSize);
                        ctx.stroke();
                    }
                    
                    // –ó–º–µ–π–∫–∞
                    this.snake.forEach((segment, index) => {
                        ctx.fillStyle = index === 0 ? '#00FF00' : '#008800';
                        ctx.shadowColor = '#00FF00';
                        ctx.shadowBlur = index === 0 ? 10 : 5;
                        ctx.fillRect(
                            offsetX + segment.x * cellSize + 1,
                            offsetY + segment.y * cellSize + 1,
                            cellSize - 2,
                            cellSize - 2
                        );
                        
                        if (index === 0) {
                            // –ì–ª–∞–∑–∞
                            ctx.fillStyle = '#FFFFFF';
                            ctx.fillRect(offsetX + segment.x * cellSize + 3, offsetY + segment.y * cellSize + 3, 3, 3);
                            ctx.fillRect(offsetX + segment.x * cellSize + cellSize - 6, offsetY + segment.y * cellSize + 3, 3, 3);
                        }
                    });
                    
                    // –ï–¥–∞
                    ctx.fillStyle = '#FF0000';
                    ctx.shadowColor = '#FF0000';
                    ctx.shadowBlur = 15;
                    ctx.fillRect(
                        offsetX + this.food.x * cellSize + 1,
                        offsetY + this.food.y * cellSize + 1,
                        cellSize - 2,
                        cellSize - 2
                    );
                }
            },
            
            // –î—Ä—É–≥–∏–µ –∏–≥—Ä—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ...
            quantum: QuantumShiftGame,
            neonrun: NeonRunnerGame,
            
            // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∏–≥—Ä
            breakout: class extends BaseGame {
                draw() {
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = '#FFF';
                    ctx.font = '24px Press Start 2P';
                    ctx.textAlign = 'center';
                    ctx.fillText('BREAKOUT', canvas.width/2, canvas.height/2);
                    ctx.fillText('Coming Soon!', canvas.width/2, canvas.height/2 + 40);
                }
            }
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function initGameList() {
            Object.keys(allGames).forEach(category => {
                const container = document.getElementById(category + 'Games');
                if (container) {
                    allGames[category].forEach(game => {
                        const gameCard = document.createElement('div');
                        gameCard.className = 'game-card';
                        gameCard.dataset.gameId = game.id;
                        
                        gameCard.innerHTML = `
                            <div class="game-icon">${game.icon}</div>
                            <div class="game-title">${game.title}</div>
                        `;
                        
                        gameCard.addEventListener('click', () => selectGame(game));
                        container.appendChild(gameCard);
                    });
                }
            });
        }
        
        function selectGame(game) {
            document.querySelectorAll('.game-card').forEach(card => {
                card.classList.remove('active');
            });
            
            document.querySelector(`[data-game-id="${game.id}"]`).classList.add('active');
            document.getElementById('gameDescription').textContent = game.description;
            
            currentGame = game;
            stopGame();
        }
        
        function loadGame() {
            if (!currentGame || !gameClasses[currentGame.id]) return;
            
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingFill = document.getElementById('loadingFill');
            const loadingText = document.getElementById('loadingText');
            
            loadingScreen.style.display = 'flex';
            
            const loadingSteps = [
                'Initializing quantum matrix...',
                'Loading game assets...',
                'Compiling shaders...',
                'Optimizing for your device...',
                'Starting game engine...'
            ];
            
            let progress = 0;
            let stepIndex = 0;
            
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                
                if (stepIndex < loadingSteps.length && progress > (stepIndex + 1) * 20) {
                    loadingText.textContent = loadingSteps[stepIndex];
                    stepIndex++;
                }
                
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(loadingInterval);
                    
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        actualStartGame();
                    }, 500);
                }
                
                loadingFill.style.width = progress + '%';
            }, 100);
        }
        
        function actualStartGame() {
            if (gameClasses[currentGame.id]) {
                activeGameInstance = new gameClasses[currentGame.id]();
                activeGameInstance.init();
                activeGameInstance.start();
                gameRunning = true;
                document.getElementById('startBtn').textContent = 'RUNNING';
                canvas.classList.add('game-transition');
                
                setTimeout(() => {
                    canvas.classList.remove('game-transition');
                }, 500);
            }
        }
        
        function startGame() {
            if (!currentGame) return;
            loadGame();
        }
        
        function pauseGame() {
            if (activeGameInstance && gameRunning) {
                activeGameInstance.pause();
                document.getElementById('pauseBtn').textContent = 
                    activeGameInstance.paused ? 'RESUME' : 'PAUSE';
            }
        }
        
        function resetGame() {
            if (activeGameInstance) {
                activeGameInstance.stop();
                activeGameInstance.init();
                gameRunning = false;
                document.getElementById('startBtn').textContent = 'START';
                document.getElementById('pauseBtn').textContent = 'PAUSE';
                hideOverlay();
            }
        }
        
        function stopGame() {
            if (activeGameInstance) {
                activeGameInstance.stop();
                activeGameInstance = null;
                gameRunning = false;
                document.getElementById('startBtn').textContent = 'START';
                document.getElementById('pauseBtn').textContent = 'PAUSE';
                hideOverlay();
                
                // –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                gradient.addColorStop(0, '#00FF00');
                gradient.addColorStop(0.5, '#00FFFF');
                gradient.addColorStop(1, '#FF00FF');
                
                ctx.fillStyle = gradient;
                ctx.font = '48px Orbitron';
                ctx.textAlign = 'center';
                ctx.fillText('MEGACONSOLE 30', canvas.width / 2, canvas.height / 2 - 60);
                
                ctx.fillStyle = '#FFFFFF';
                ctx.font = '20px Press Start 2P';
                ctx.fillText('SELECT GAME TO START', canvas.width / 2, canvas.height / 2);
                
                ctx.font = '14px Press Start 2P';
                ctx.fillText('30 GAMES ‚Ä¢ ULTIMATE EXPERIENCE', canvas.width / 2, canvas.height / 2 + 40);
                
                ctx.font = '12px Press Start 2P';
                ctx.fillText('OPTIMIZED FOR PC & MOBILE', canvas.width / 2, canvas.height / 2 + 80);
            }
        }
        
        function showOverlay(title, text) {
            document.getElementById('overlayTitle').textContent = title;
            document.getElementById('overlayText').textContent = text;
            document.getElementById('gameOverlay').style.display = 'flex';
        }
        
        function hideOverlay() {
            document.getElementById('gameOverlay').style.display = 'none';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('keydown', (e) => {
            // –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
            keys[e.code] = true;
            
            // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∞–≤–∏—à–∏
            const keyMap = {
                'KeyW': 'ArrowUp', 'KeyS': 'ArrowDown',
                'KeyA': 'ArrowLeft', 'KeyD': 'ArrowRight',
                'KeyH': 'ArrowLeft', 'KeyJ': 'ArrowDown',
                'KeyK': 'ArrowUp', 'KeyL': 'ArrowRight',
                'KeyI': 'ArrowUp', 'Comma': 'ArrowDown',
                'KeyO': 'ArrowLeft', 'Period': 'ArrowRight'
            };
            
            if (keyMap[e.code]) {
                keys[keyMap[e.code]] = true;
            }
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Space'].includes(e.code)) {
                e.preventDefault();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
            
                        if (keyMap[e.code]) {
                keys[keyMap[e.code]] = true;
            }
        });
        
        // –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        document.querySelectorAll('.dpad-btn, .action-btn').forEach(btn => {
            // –ú—ã—à—å —Å–æ–±—ã—Ç–∏—è
            btn.addEventListener('mousedown', (e) => {
                e.preventDefault();
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = true;
                    btn.style.transform = 'scale(0.9)';
                }
            });
            
            btn.addEventListener('mouseup', (e) => {
                e.preventDefault();
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = false;
                    btn.style.transform = 'scale(1)';
                }
            });
            
            btn.addEventListener('mouseleave', (e) => {
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = false;
                    btn.style.transform = 'scale(1)';
                }
            });
            
            // Touch —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = true;
                    btn.style.transform = 'scale(0.9)';
                    btn.style.background = 'linear-gradient(45deg, #6a4a4a, #5a3a3a)';
                }
            });
            
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = false;
                    btn.style.transform = 'scale(1)';
                    btn.style.background = '';
                }
            });
            
            btn.addEventListener('touchcancel', (e) => {
                e.preventDefault();
                const key = btn.dataset.key;
                if (key) {
                    keys[key] = false;
                    btn.style.transform = 'scale(1)';
                    btn.style.background = '';
                }
            });
        });
        
        // –°–∏—Å—Ç–µ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
        document.getElementById('startBtn').addEventListener('click', () => {
            if (!gameRunning && currentGame) {
                startGame();
            }
        });
        
        document.getElementById('pauseBtn').addEventListener('click', pauseGame);
        document.getElementById('resetBtn').addEventListener('click', resetGame);
        
        // –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–≥—Ä –∫–ª–∞–≤–∏—à–∞–º–∏
        document.addEventListener('keydown', (e) => {
            // –¶–∏—Ñ—Ä–æ–≤—ã–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä
            if (e.key >= '1' && e.key <= '9') {
                const gameIndex = parseInt(e.key) - 1;
                const allGamesList = Object.values(allGames).flat();
                if (gameIndex < allGamesList.length) {
                    selectGame(allGamesList[gameIndex]);
                }
                e.preventDefault();
            }
            
            // Shift + —Ü–∏—Ñ—Ä–∞ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
            if (e.shiftKey && e.key >= '1' && e.key <= '9') {
                const gameIndex = parseInt(e.key) - 1;
                const allGamesList = Object.values(allGames).flat();
                if (gameIndex < allGamesList.length) {
                    selectGame(allGamesList[gameIndex]);
                    setTimeout(() => startGame(), 100);
                }
                e.preventDefault();
            }
            
            // Q/E –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∏–≥—Ä
            if (e.code === 'KeyQ' && !gameRunning) {
                navigateGames(-1);
                e.preventDefault();
            }
            if (e.code === 'KeyE' && !gameRunning) {
                navigateGames(1);
                e.preventDefault();
            }
            
            // ESC –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –∏–≥—Ä—ã
            if (e.code === 'Escape' && gameRunning) {
                if (activeGameInstance && !activeGameInstance.paused) {
                    pauseGame();
                } else {
                    stopGame();
                }
                e.preventDefault();
            }
            
            // F –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
            if (e.code === 'KeyF') {
                toggleFullscreen();
                e.preventDefault();
            }
        });
        
        function navigateGames(direction) {
            const allGamesList = Object.values(allGames).flat();
            const currentIndex = allGamesList.findIndex(game => game.id === currentGame?.id);
            
            if (currentIndex !== -1) {
                const newIndex = (currentIndex + direction + allGamesList.length) % allGamesList.length;
                selectGame(allGamesList[newIndex]);
                
                // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∏–≥—Ä–µ
                const gameCard = document.querySelector(`[data-game-id="${allGamesList[newIndex].id}"]`);
                if (gameCard) {
                    gameCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log(`Error enabling fullscreen: ${err.message}`);
                });
            } else {
                document.exitFullscreen();
            }
        }
        
        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–µ—Å–∞–π–∑ canvas
        function resizeCanvas() {
            const container = document.querySelector('.game-display');
            const containerRect = container.getBoundingClientRect();
            
            // –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω 4:3
            let newWidth = containerRect.width - 40;
            let newHeight = (newWidth * 3) / 4;
            
            if (newHeight > containerRect.height - 40) {
                newHeight = containerRect.height - 40;
                newWidth = (newHeight * 4) / 3;
            }
            
            canvas.style.width = newWidth + 'px';
            canvas.style.height = newHeight + 'px';
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HiDPI
            const dpr = window.devicePixelRatio || 1;
            canvas.width = 800 * dpr;
            canvas.height = 600 * dpr;
            ctx.scale(dpr, dpr);
            ctx.imageSmoothingEnabled = false;
        }
        
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('orientationchange', () => {
            setTimeout(resizeCanvas, 100);
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑—É–º–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        class SaveSystem {
            static save(gameId, data) {
                try {
                    const saveData = JSON.stringify(data);
                    localStorage.setItem(`megaconsole_${gameId}`, saveData);
                    return true;
                } catch (e) {
                    console.log('Save failed:', e);
                    return false;
                }
            }
            
            static load(gameId) {
                try {
                    const saveData = localStorage.getItem(`megaconsole_${gameId}`);
                    return saveData ? JSON.parse(saveData) : null;
                } catch (e) {
                    console.log('Load failed:', e);
                    return null;
                }
            }
            
            static saveSettings(settings) {
                this.save('settings', settings);
            }
            
            static loadSettings() {
                return this.load('settings') || {
                    volume: 0.3,
                    controls: 'default',
                    theme: 'dark'
                };
            }
        }
        
        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        class AchievementSystem {
            constructor() {
                this.achievements = {
                    first_game: { name: 'First Steps', description: 'Play your first game', unlocked: false },
                    tetris_master: { name: 'Tetris Master', description: 'Clear 4 lines at once', unlocked: false },
                    speed_demon: { name: 'Speed Demon', description: 'Reach level 10 in any game', unlocked: false },
                    collector: { name: 'Game Collector', description: 'Try 10 different games', unlocked: false },
                    perfectionist: { name: 'Perfectionist', description: 'Get 100,000 points in any game', unlocked: false },
                    quantum_master: { name: 'Quantum Master', description: 'Master dimension shifting', unlocked: false },
                    neon_runner: { name: 'Neon Runner', description: 'Survive 1000 distance units', unlocked: false }
                };
                
                this.loadProgress();
            }
            
            unlock(achievementId) {
                if (this.achievements[achievementId] && !this.achievements[achievementId].unlocked) {
                    this.achievements[achievementId].unlocked = true;
                    this.showAchievementNotification(this.achievements[achievementId]);
                    this.saveProgress();
                    soundSystem.playLevelUp();
                }
            }
            
            showAchievementNotification(achievement) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(45deg, #ffd700, #ffed4e);
                    color: #000;
                    padding: 15px 20px;
                    border-radius: 10px;
                    font-family: 'Press Start 2P';
                    font-size: 10px;
                    z-index: 1000;
                    box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
                    animation: achievementSlide 3s ease-out forwards;
                `;
                
                notification.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">üèÜ ACHIEVEMENT UNLOCKED!</div>
                    <div style="font-size: 8px;">${achievement.name}</div>
                    <div style="font-size: 6px; margin-top: 3px;">${achievement.description}</div>
                `;
                
                // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é
                if (!document.getElementById('achievement-styles')) {
                    const style = document.createElement('style');
                    style.id = 'achievement-styles';
                    style.textContent = `
                        @keyframes achievementSlide {
                            0% { transform: translateX(100%); opacity: 0; }
                            20% { transform: translateX(0); opacity: 1; }
                            80% { transform: translateX(0); opacity: 1; }
                            100% { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 3000);
            }
            
            saveProgress() {
                SaveSystem.save('achievements', this.achievements);
            }
            
            loadProgress() {
                const saved = SaveSystem.load('achievements');
                if (saved) {
                    this.achievements = { ...this.achievements, ...saved };
                }
            }
        }
        
        const achievementSystem = new AchievementSystem();
        
        // –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏—Ü
        class ParticleSystem {
            constructor() {
                this.particles = [];
            }
            
            create(x, y, options = {}) {
                const particle = {
                    x: x,
                    y: y,
                    vx: options.vx || (Math.random() - 0.5) * 10,
                    vy: options.vy || (Math.random() - 0.5) * 10,
                    life: options.life || 60,
                    maxLife: options.life || 60,
                    color: options.color || '#FFFFFF',
                    size: options.size || Math.random() * 5 + 2,
                    gravity: options.gravity || 0.2,
                    friction: options.friction || 0.98,
                    glow: options.glow || false
                };
                
                this.particles.push(particle);
            }
            
            createExplosion(x, y, count = 15, colors = ['#FF0000', '#FF6600', '#FFFF00']) {
                for (let i = 0; i < count; i++) {
                    const angle = (i / count) * Math.PI * 2;
                    const speed = Math.random() * 8 + 4;
                    
                    this.create(x, y, {
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        life: 40 + Math.random() * 20,
                        size: Math.random() * 6 + 3,
                        glow: true
                    });
                }
            }
            
            update() {
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += particle.gravity;
                    particle.vx *= particle.friction;
                    particle.vy *= particle.friction;
                    particle.life--;
                    
                    return particle.life > 0;
                });
            }
            
            render(ctx) {
                this.particles.forEach(particle => {
                    ctx.save();
                    ctx.globalAlpha = particle.life / particle.maxLife;
                    
                    if (particle.glow) {
                        ctx.shadowColor = particle.color;
                        ctx.shadowBlur = 10;
                    }
                    
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.restore();
                });
            }
        }
        
        const globalParticles = new ParticleSystem();
        
        // –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function createSettingsPanel() {
            const panel = document.createElement('div');
            panel.id = 'settingsPanel';
            panel.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(145deg, #2a2a3a, #1a1a2a);
                border: 3px solid #00ff64;
                border-radius: 15px;
                padding: 30px;
                z-index: 1000;
                display: none;
                font-family: 'Press Start 2P';
                color: #00ff64;
                min-width: 400px;
            `;
            
            panel.innerHTML = `
                <h3 style="text-align: center; margin-bottom: 20px;">‚öôÔ∏è SETTINGS</h3>
                
                <div style="margin: 15px 0;">
                    <label>üîä Volume: <span id="volumeValue">30%</span></label>
                    <input type="range" id="volumeSlider" min="0" max="100" value="30" 
                           style="width: 100%; margin-top: 5px;">
                </div>
                
                <div style="margin: 15px 0;">
                    <label>üéÆ Control Scheme:</label>
                    <select id="controlScheme" style="width: 100%; margin-top: 5px; background: #1a1a2a; color: #00ff64; border: 1px solid #00ff64; padding: 5px;">
                        <option value="arrows">Arrow Keys</option>
                        <option value="wasd">WASD</option>
                        <option value="vim">Vim (HJKL)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                
                <div style="margin: 15px 0;">
                    <label>üé® Theme:</label>
                    <select id="themeSelect" style="width: 100%; margin-top: 5px; background: #1a1a2a; color: #00ff64; border: 1px solid #00ff64; padding: 5px;">
                        <option value="dark">Dark Green</option>
                        <option value="blue">Cyber Blue</option>
                        <option value="red">Matrix Red</option>
                        <option value="purple">Neon Purple</option>
                    </select>
                </div>
                
                <div style="text-align: center; margin-top: 25px;">
                    <button id="saveSettings" style="background: #00ff64; color: #000; border: none; padding: 10px 20px; margin: 0 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 8px;">SAVE</button>
                    <button id="closeSettings" style="background: #ff6464; color: #000; border: none; padding: 10px 20px; margin: 0 10px; cursor: pointer; font-family: 'Press Start 2P'; font-size: 8px;">CLOSE</button>
                </div>
            `;
            
            document.body.appendChild(panel);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('volumeSlider').addEventListener('input', (e) => {
                const value = e.target.value;
                document.getElementById('volumeValue').textContent = value + '%';
                soundSystem.masterVolume = value / 100;
            });
            
            document.getElementById('saveSettings').addEventListener('click', () => {
                const settings = {
                    volume: document.getElementById('volumeSlider').value,
                    controls: document.getElementById('controlScheme').value,
                    theme: document.getElementById('themeSelect').value
                };
                
                SaveSystem.saveSettings(settings);
                applyTheme(settings.theme);
                panel.style.display = 'none';
            });
            
            document.getElementById('closeSettings').addEventListener('click', () => {
                panel.style.display = 'none';
            });
            
            return panel;
        }
        
        function applyTheme(theme) {
            const themes = {
                dark: { primary: '#00ff64', secondary: '#ff6464', accent: '#ffff64' },
                blue: { primary: '#00aaff', secondary: '#ff6600', accent: '#ffff00' },
                red: { primary: '#ff4444', secondary: '#44ff44', accent: '#ffff44' },
                purple: { primary: '#aa44ff', secondary: '#44ffaa', accent: '#ffaa44' }
            };
            
            const selectedTheme = themes[theme];
            if (selectedTheme) {
                document.documentElement.style.setProperty('--primary-color', selectedTheme.primary);
                document.documentElement.style.setProperty('--secondary-color', selectedTheme.secondary);
                document.documentElement.style.setProperty('--accent-color', selectedTheme.accent);
            }
        }
        
        // –î–æ–±–∞–≤–∏–º –∫–Ω–æ–ø–∫—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
        const settingsBtn = document.createElement('div');
        settingsBtn.className = 'system-btn';
        settingsBtn.textContent = 'SET';
        settingsBtn.style.fontSize = '8px';
        settingsBtn.addEventListener('click', () => {
            document.getElementById('settingsPanel').style.display = 'block';
        });
        document.querySelector('.system-controls').appendChild(settingsBtn);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            console.log('üéÆ Initializing MegaConsole 30...');
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            createSettingsPanel();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const settings = SaveSystem.loadSettings();
            soundSystem.masterVolume = settings.volume / 100;
            applyTheme(settings.theme);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –∏–≥—Ä
            initGameList();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–µ—Ä–≤–æ–π –∏–≥—Ä—ã
            const firstGame = allGames.puzzle[0];
            if (firstGame) {
                selectGame(firstGame);
            }
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π canvas
            resizeCanvas();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
            document.addEventListener('click', function initSound() {
                soundSystem.initAudio();
                if (soundSystem.audioContext) {
                    soundSystem.audioContext.resume();
                }
                achievementSystem.unlock('first_game');
                document.removeEventListener('click', initSound);
            }, { once: true });
            
            // –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω
            stopGame();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —á–∞—Å—Ç–∏—Ü –Ω–∞ –∑–∞–¥–Ω–µ–º —Ñ–æ–Ω–µ
            function backgroundAnimation() {
                if (!gameRunning) {
                    if (Math.random() < 0.02) {
                        globalParticles.create(
                            Math.random() * canvas.width,
                            Math.random() * canvas.height,
                            {
                                vx: (Math.random() - 0.5) * 2,
                                vy: (Math.random() - 0.5) * 2,
                                color: '#00ff64',
                                life: 120,
                                size: 1,
                                glow: true
                            }
                        );
                    }
                    
                    globalParticles.update();
                    globalParticles.render(ctx);
                }
                
                requestAnimationFrame(backgroundAnimation);
            }
            backgroundAnimation();
            
            console.log('‚úÖ MegaConsole 30 initialized successfully!');
            console.log('üéØ Available games:', Object.values(allGames).flat().length);
            console.log('‚å®Ô∏è Use number keys 1-9 for quick game selection');
            console.log('üöÄ Use Shift+Number for instant game launch');
            console.log('‚öôÔ∏è Press F for fullscreen mode');
        }
        
        // –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Å–æ–ª–∏
        init();
        
        // Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript;base64,' + btoa(`
                const CACHE_NAME = 'megaconsole-v1';
                
                self.addEventListener('install', (event) => {
                    event.waitUntil(
                        caches.open(CACHE_NAME).then((cache) => {
                            return cache.addAll(['/']);
                        })
                    );
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(
                        caches.match(event.request).then((response) => {
                            return response || fetch(event.request);
                        })
                    );
                });
            `)).then(() => {
                console.log('üì± Service Worker registered for offline play');
            }).catch(() => {
                console.log('‚ùå Service Worker registration failed');
            });
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.MegaConsole = {
            version: '3.0',
            gameCount: Object.values(allGames).flat().length,
            selectGame,
            startGame,
            achievementSystem,
            soundSystem,
            saveSystem: SaveSystem
        };
        
        console.log(`
        ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        ‚ïë        MEGACONSOLE 30 LOADED!        ‚ïë
        ‚ïë                                      ‚ïë
        ‚ïë  üéÆ 30 Games Ready                   ‚ïë
        ‚ïë  üì± Mobile Optimized                 ‚ïë
        ‚ïë  üéµ Advanced Sound System            ‚ïë
        ‚ïë  üèÜ Achievement System               ‚ïë
        ‚ïë  üíæ Auto-Save Progress               ‚ïë
        ‚ïë  ‚öôÔ∏è Customizable Settings            ‚ïë
        ‚ïë                                      ‚ïë
        ‚ïë  Ready for Ultimate Gaming!          ‚ïë
        ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        `);
    </script>
</body>
</html>
